{"version":3,"file":"vue.js","sources":["../src/compiler/parser.js","../src/compiler/index.js","../src/utils.js","../src/global-api/index.js","../src/observe/array.js","../src/observe/dep.js","../src/observe/index.js","../src/state.js","../src/observe/scheduler.js","../src/observe/watcher.js","../src/vdom/index.js","../src/vdom/patch.js","../src/lifecycle.js","../src/init.js","../src/render.js","../src/index.js"],"sourcesContent":["\n// 匹配标签名：aa-xxx\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`;\n// 命名空间标签：aa:aa-xxx\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\n// 匹配标签名(索引1)：<aa:aa-xxx\nconst startTagOpen = new RegExp(`^<${qnameCapture}`);\n// 匹配标签名(索引1)：</aa:aa-xxxdsadsa> \nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`);\n// 匹配属性（索引 1 为属性 key、索引 3、4、5 其中一直为属性值）：aaa=\"xxx\"、aaa='xxx'、aaa=xxx\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\n// 匹配结束标签：> 或 />\nconst startTagClose = /^\\s*(\\/?)>/;\n// 匹配 {{   xxx    }} ，匹配到 xxx\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g\n\nexport function parserHTML(html) {\n  console.log(\"***** 进入 parserHTML：将模板编译成 AST 语法树 *****\")\n  let stack = [];\n  let root = null;\n  // 构建父子关系\n  function createASTElement(tag, attrs, parent) {\n    return {\n      tag,  // 标签名\n      type:1, // 元素类型为 1\n      children:[],  // 儿子\n      parent, // 父亲\n      attrs // 属性\n    }\n  }\n  // 开始标签,如:[div,p]\n  function start(tag, attrs) {\n    console.log(\"发射匹配到的开始标签-start,tag = \" + tag + \",attrs = \" + JSON.stringify(attrs))\n    // 遇到开始标签，就取栈中最后一个，作为父节点\n    let parent = stack[stack.length-1];\n    let element = createASTElement(tag, attrs, parent);\n    // 还没有根节点时，作为根节点\n    if(root == null) root = element;\n    if(parent){ // 父节点存在\n      element.parent = parent;  // 为当前节点设置父节点\n      parent.children.push(element) // 同时，当前节点也称为父节点的子节点\n    }\n    stack.push(element)\n  }\n  // 结束标签\n  function end(tagName) {\n    console.log(\"发射匹配到的结束标签-end,tagName = \" + tagName)\n    // 如果是结束标签，就从栈中抛出\n    let endTag = stack.pop();\n    // check:抛出的结束标签名与当前结束标签名是否一直\n    if(endTag.tag != tagName)console.log(\"标签出错\")\n  }\n  // 文本\n  function text(chars) {\n    console.log(\"发射匹配到的文本-text,chars = \" + chars)\n    // 文本直接放到前一个中 注意：文本可能有空白字符\n    let parent = stack[stack.length-1];\n    chars = chars.replace(/\\s/g, \"\"); // 将空格替换为空，即删除空格\n    if(chars){\n      parent.children.push({\n        type:2, // 文本类型为 2\n        text:chars\n      })\n    }\n  }\n  /**\n   * 截取字符串\n   * @param {*} len 截取长度\n   */\n  function advance(len) {\n    html = html.substring(len);\n    console.log(\"截取匹配内容后的 html:\" + html)\n    console.log(\"===============================\")\n  }\n\n  /**\n   * 匹配开始标签,返回匹配结果\n   */\n  function parseStartTag() {\n    console.log(\"***** 进入 parseStartTag，尝试解析开始标签，当前 html： \" + html + \"*****\")\n    // 匹配开始标签，开始标签名为索引 1\n    const start = html.match(startTagOpen);\n    if(start){// 匹配到开始标签再处理\n      // 构造匹配结果，包含：标签名 + 属性\n      const match = {\n        tagName: start[1],\n        attrs: []\n      }\n      console.log(\"html.match(startTagOpen) 结果:\" + JSON.stringify(match))\n      // 截取匹配到的结果\n      advance(start[0].length)\n      let end;  // 是否匹配到开始标签的结束符号>或/>\n      let attr; // 存储属性匹配的结果\n      // 匹配属性且不能为开始的结束标签，例如：<div>，到>就已经结束了，不再继续匹配该标签内的属性\n      //    attr = html.match(attribute)  匹配属性并赋值当前属性的匹配结果\n      //    !(end = html.match(startTagClose))   没有匹配到开始标签的关闭符号>或/>\n      while (!(end = html.match(startTagClose)) && (attr = html.match(attribute))) {\n        // 将匹配到的属性,push到attrs数组中，匹配到关闭符号>,while 就结束\n        console.log(\"匹配到属性 attr = \" + JSON.stringify(attr))\n        // console.log(\"匹配到属性 name = \" + attr[1] + \"value = \" + attr[3] || attr[4] || attr[5])\n        match.attrs.push({ name: attr[1], value: attr[3] || attr[4] || attr[5] })\n        advance(attr[0].length)// 截取匹配到的属性 xxx=xxx\n      }\n      // 匹配到关闭符号>,当前标签处理完成 while 结束,\n      // 此时，<div id=\"app\" 处理完成，需连同关闭符号>一起被截取掉\n      if (end) {\n        console.log(\"匹配关闭符号结果 html.match(startTagClose):\" + JSON.stringify(end))\n        advance(end[0].length)\n      }\n\n      // 开始标签处理完成后，返回匹配结果：tagName标签名 + attrs属性\n      console.log(\">>>>> 开始标签的匹配结果 startTagMatch = \" + JSON.stringify(match))\n      return match;\n    }\n    console.log(\"未匹配到开始标签，返回 false\")\n    console.log(\"===============================\")\n    return false;\n  }\n\n  // 对模板不停截取，直至全部解析完毕\n  while (html) {\n    // 解析标签和文本(看开头是否为<)\n    let index = html.indexOf('<');\n    if (index == 0) {// 标签\n      console.log(\"解析 html：\" + html + \",结果：是标签\")\n      // 如果是标签，继续解析开始标签和属性\n      const startTagMatch = parseStartTag();// 匹配开始标签，返回匹配结果\n      if (startTagMatch) {  // 匹配到了，说明是开始标签\n        // 匹配到开始标签，调用start方法，传递标签名和属性\n        start(startTagMatch.tagName, startTagMatch.attrs)\n        continue; // 如果是开始标签，就不需要继续向下走了，继续 while 解析后面的部分\n      }\n      // 如果开始标签没有匹配到，有可能是结束标签 </div>\n      let endTagMatch;\n      if (endTagMatch = html.match(endTag)) {// 匹配到了，说明是结束标签\n        // 匹配到开始标签，调用start方法，传递标签名和属性\n        end(endTagMatch[1])\n        advance(endTagMatch[0].length)\n        continue; // 如果是结束标签，也不需要继续向下走了，继续 while 解析后面的部分\n      }\n    } else {// 文本\n      console.log(\"解析 html：\" + html + \",结果：是文本\")\n    }\n\n    // 文本：index > 0 \n    if(index > 0){\n      // 将文本取出来并发射出去,再从 html 中拿掉\n      let chars = html.substring(0,index) // hello</div>\n      text(chars);\n      advance(chars.length)\n    }\n  }\n  console.log(\"当前 template 模板，已全部解析完成\")\n  return root;\n}","import { parserHTML } from \"./parser\";\n\n// 将attrs数组=>{key=val,key=val,}\nfunction genProps(attrs) {\n  let str = '';\n  for(let i = 0; i< attrs.length; i++){\n    let attr = attrs[i];\n    \n    if(attr.name == \"style\"){ // 将样式处理为对象 {name:id, value:'app'}\n      let styles = {};\n      // <div id=\"app\" style=\"color: red;background: blue;\"></div>\n      // 使用replace正则匹配：不断进行key 和 value替换\n      // ^;: 不是分号(分割属性和值)、冒号(结尾)\n      attr.value.replace(/([^;:]+):([^;:]+)/g, function () {\n        styles[arguments[1]] = arguments[2]\n      }) \n      attr.value = styles;\n    }\n    str += `${attr.name}:${JSON.stringify(attr.value)},`// JSON.stringify 将 value 转为 string\n  }\n  return `{${str.slice(0, -1)}}`;// 去掉最后一位多余的，外边套上{}\n }\n\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g\n\nfunction gen(el) {\n  console.log(\"===== gen ===== el = \",el)\n  if(el.type == 1){// \n    console.log(\"元素标签 tag = \"+el.tag+\"，generate继续递归处理\")\n    return generate(el);// 如果是元素就递归的生成\n  }else{// 文本类型\n    let text = el.text\n    console.log(\"文本类型,text = \" + text)\n    if(!defaultTagRE.test(text)){\n      return `_v('${text}')`  // 普通文本，包装_v\n    }else{\n      // 存在{{}}表达式，需进行表达式 和 普通值的拼接 \n      // 目标：['aaa',_s(name),'bbb'].join('+') ==> _v('aaa' + s_(name) + 'bbb')\n      let lastIndex = defaultTagRE.lastIndex = 0;\n      let tokens = []; // <div>aaa {{name}} bbb</div>\n      let match\n      while(match = defaultTagRE.exec(text)){\n        console.log(\"匹配内容\" + text)\n        let index = match.index;// match.index：指当前捕获到的位置\n        console.log(\"当前的 lastIndex = \" + lastIndex)\n        console.log(\"匹配的 match.index = \" + index)\n        if(index > lastIndex){  // 将前一段 ’<div>aaa '中的 aaa 放入 tokens 中\n          let preText = text.slice(lastIndex, index)\n          console.log(\"匹配到表达式-找到表达式开始前的部分：\" + preText)\n          tokens.push(JSON.stringify(preText))// 利用 JSON.stringify 加双引号\n        }\n\n        console.log(\"匹配到表达式：\" + match[1].trim())\n        // 放入 match 到的表达式，如{{ name  }}（match[1]是花括号中间的部分，并处理可能存在的换行或回车）\n        tokens.push(`_s(${match[1].trim()})`)\n        // 更新 lastIndex 长度到'<div>aaa {{name}}'\n        lastIndex = index + match[0].length;  // 更新 lastIndex 长度到'<div>aaa {{name}}'\n      }\n\n      // while 循环后可能还剩余一段，如：’ bbb</div>’，需要将 bbb 放到 tokens 中\n      if(lastIndex < text.length){\n        let lastText = text.slice(lastIndex);\n        console.log(\"表达式处理完成后，还有内容需要继续处理：\"+lastText)\n        tokens.push(JSON.stringify(lastText))// 从lastIndex到最后\n      }\n      \n      return `_v(${tokens.join('+')})`\n    }\n  }\n}\n\nfunction genChildren(el) {\n  console.log(\"===== genChildren =====\")\n  let children = el.children;\n  if(children){\n    console.log(\"存在 children, 开始遍历处理子节点．．．\", children)\n    let result = children.map(item => gen(item)).join(',');\n    console.log(\"子节点处理完成，result = \" + JSON.stringify(result))\n    return result\n  }\n  console.log(\"不存在 children, 直接返回 false\")\n  return false;\n}\n\n// _c(div,{},c1,c2,c3...)\nfunction generate(ast) {\n\n  console.log(\"===== generate =====> 当前 ast = \")\n  console.log(ast)\n  let children = genChildren(ast);\n\n  console.log(\"===== 开始拼装 render 函数 =====\")\n  let code = `_c('${ast.tag}',${\n    ast.attrs.length? genProps(ast.attrs):'undefined'\n  }${\n    children?`,${children}`:''\n  })`\n  console.log(\"===== render 函数 =====> code = \" + code)\n\n  return code;\n}\n\nexport function compileToFunction(template) {\n  console.log(\"***** 进入 compileToFunction：将 template 编译为 render 函数 *****\")\n  \n  // 1，将模板变成 AST 语法树\n  let ast = parserHTML(template);\n  // 2，使用 AST 生成 render 函数\n  let code = generate(ast); // 生成 code\n  let render = new Function(`with(this){return ${code}}`);  // 包装 with + new Function\n  // console.log(\"包装 with 生成 render 函数：\"+ render.toString())\n  \n  return render;\n}","export function isFunction(val){\n  return typeof val == 'function'\n}\n\n/**\n * 判断是否是对象：类型是object，且不能为 null\n * @param {*} val \n * @returns \n */\nexport function isObject(val) {\n  return typeof val == 'object' && val !== null\n}\n\n/**\n * 判断是否是数组\n * @param {*} val \n * @returns \n */\nexport function isArray(val) {\n  return Array.isArray(val)\n}\n\nlet callbacks = []; // 缓存异步更新的 nextTick\nlet waiting = false;\nfunction flushsCallbacks() {\n  callbacks.forEach(fn => fn()) // 依次执行 nextTick\n  callbacks = [];   // reset\n  waiting = false;  // reset\n}\n\n/**\n * 将方法异步化\n * @param {*} fn 需要异步化的方法\n * @returns \n */\nexport function nextTick(fn) {\n  // return Promise.resolve().then(fn);\n  callbacks.push(fn); // 先缓存异步更新的nextTick,后续统一处理\n  if(!waiting){\n    Promise.resolve().then(flushsCallbacks);\n    waiting = true; // 首次进入被置为 true,控制逻辑只走一次\n  }\n}\n\nlet strats = {};  // 存放所有策略\nlet lifeCycle = [\n  'beforeCreate',\n  'created',\n  'beforeMount',\n  'mounted'\n];\nlifeCycle.forEach(hook => {\n  // 创建生命周期的合并策略\n  strats[hook] = function (parentVal, childVal) {\n    if(childVal){ // 儿子有值，需要进行合并\n      if(parentVal){\n        // 父亲儿子都有值：父亲一定是数组，将儿子合入父亲\n        return parentVal.concat(childVal);  \n      }else{\n        // 儿子有值，父亲没有值：儿子放入新数组中\n        // return [childVal]\n        // 注意：如果传入的生命周期函数是数组，已经是数组了不能再包成数组\n        if(Array.isArray(childVal)){\n          return childVal;\n        }else{\n          return [childVal];\n        }\n      }\n    }else{  // 儿子没有值，无需合并，直接返回父亲即可\n      return parentVal;\n    }\n  }\n})\n\n// parentVal为函数；childVal为对象；\nstrats.components = function (parentVal, childVal) {\n  // 继承：childVal.__proto__ = parentVal 子类可以沿着链找到父类的属性\n  let res = Object.create(parentVal);\n  if(childVal){\n    for (let key in childVal) {\n     res[key] = childVal[key];\n    }\n\n    return res;\n  }\n}\n/**\n * 对象合并:将childVal合并到parentVal中\n * @param {*} parentVal   父值-老值\n * @param {*} childVal    子值-新值\n */\nexport function mergeOptions(parentVal, childVal) {\n  let options = {};\n  for(let key in parentVal){\n    mergeFiled(key);\n  }\n  for(let key in childVal){\n    // 当新值存在，老值不存在时：添加到老值中\n    if(!parentVal.hasOwnProperty(key)){\n      mergeFiled(key);\n    }\n  }\n  // 合并当前 key \n  function mergeFiled(key) {\n    // 策略模式：获取当前合并策略\n    let strat = strats[key];\n    if(strat){  \n      options[key] = strat(parentVal[key], childVal[key]);\n    }else{  // 默认合并策略：新值覆盖老值\n      options[key] = childVal[key] || parentVal[key];\n    }\n  }\n\n  return options;\n}","import { isObject, mergeOptions } from \"../utils\";\n\nexport function initGlobalAPI(Vue) {\n  // 全局属性：Vue.options\n  // 功能：存放 mixin, component, filte, directive 属性\n  Vue.options = {}; // 每个组件初始化时，将这些属性放入组件\n  Vue.mixin = function (options) {\n    this.options = mergeOptions(this.options, options);\n    console.log(\"打印mixin合并后的options\", this.options);\n    return this;  // 返回this,提供链式调用\n  }\n\n  /**\n   * 使用基础的 Vue 构造器，创造一个子类\n   *  new 子类时，执行组件的初始化 _init\n   * @param {*} definition \n   */\n  Vue.extend = function (opt) {\n    // 父类：Vue 即当前 this;\n    const Super = this;\n    // 创建子类，继承父类\n    const Sub = function (options) {\n      // new 组件时，执行组件初始化\n      this._init(options);\n    }\n\n    // // Object.create 实现原理\n    // // 调用create就会产生一个新的实例，这个实例上具备父类的原型\n    // function create(parentPrototype) {\n    //   const Fn = function () {}\n    //   Fn.prototype = parentPrototype;\n    //   return new Fn();\n    // }\n\n    // 父类原型：Super.prototype \n    // 继承父类的原型方法：Object.create(Super.prototype)\n    // Object.create(Super.prototype) 等同于：Sub.prototype.__proto__ = Supper.prototype\n    Sub.prototype = Object.create(Super.prototype);\n    // 修复 constructor 指向问题：Object.create 会产生一个新的实例作为子类的原型，导致constructor指向错误\n    Sub.prototype.constructor = Sub;\n    // 合并父类和子类的选项:需要让子类能拿到 Vue 定义的全局组件\n    Sub.options = mergeOptions(Super.options, opt);\n    // 其他\n    Sub.mixin = Vue.mixin;\n\n    return Sub;\n  }\n\n  Vue.options.components = {};// 存放全局组件\n  /**\n   * Vue.component\n   * @param {*} id          组件名（默认）\n   * @param {*} definition  组件定义：可能是对象或函数\n   */\n  Vue.component = function (id, definition) {\n\n    // 获取组件名 name:优先使用definition.name，默认使用 id\n    let name = definition.name || id;\n    definition.name = name;\n\n    // 如果传入的 definition 是对象，需要用Vue.extends包裹\n    if(isObject(definition)){\n      definition = Vue.extend(definition)\n    }\n\n    // 将 definition 对象保存到全局：Vue.options.components\n    Vue.options.components[name] = definition;\n\n  }\n}","// 重写数组方法\n// 思路：拿到原来的方法，将部分需要重写的方法重写掉\n\nlet oldArrayPrototype = Array.prototype;// 获取数组老的原型方法\n\n// 通过arrayMethods上的链能拿到数组上的原有方法\tarrayMethods.__proto__ == oldArrayPrototype\nexport let arrayMethods = Object.create(oldArrayPrototype);// 使arrayMethods可以通过__proto__，能获取到数组的方法\n\n// 重写这7个会导致数组发生变化的方法（影响原数组变化的方法，会影响到视图的更新）\nlet methods = [\n  'push',\n  'pop',\n  'shift',\n  'unshift',\n  'reverse',\n  'sort',\n  'splice'\n]\n\n// 为arrayMethods添加这 7 个“重写方法”\n//  arrayMethods.push()  会在自己身上找到重写的push方法\n//  arrayMethods.concat() 自己身上没找到，回去链上找到原来的方法\n// 这种方式的好处：\n//  属性的查找会先在自己身上找，找不到再去原型上找，所以会优先调用重写的方法\n//  同时，只重写了 data 中数组原型的方法，不会影响到其他数组\n// 数组劫持的实现，因为只劫持了这7个方法，所以修改数组的索引和长度都不能触发视图更新\nmethods.forEach(method => {\n  // 当前的外部调用：arr.push\n  arrayMethods[method] = function (...args) {\n    console.log('数组的方法进行重写操作 method = ' + method)\n    // AOP:before 原生方法扩展... \n    // 调用数组原生方法逻辑（绑定到当前调用上下文）\n    oldArrayPrototype[method].call(this, ...args)\n    // AOP::after 原生方法扩展...\n\n    // 数组新增的属性如果是属性，要继续观测\n    // 哪些方法有增加数组的功能: splice push unshift\n    let inserted = null;\n    let ob = this.__ob__;\n    \n    switch (method) {\n      // arr.splice(0,0,100) 如果splice方法用于增加,一定有第三个参数,从第三个开始都是添加的内容\n      case 'splice':  // 修改 删除 添加\n        inserted = args.slice(2); // splice方法从第三个参数起是新增数据\n      case 'push':    // 向前增加\n      case 'unshift': // 向后增加\n        inserted = args // push、unshift的参数就是新增\n        break;\n    }\n\n    // observeArray：内部遍历inserted数组,调用observe方法，是对象就new Observer，继续深层观测\n    if(inserted)ob.observeArray(inserted);// inserted 有值就是数组\n    ob.dep.notify();  // 触发视图更新\n  }\n});\n\n// 数组劫持的实现：劫持这 7个方法，所以修改索引和长度都是不能触发视图变化的","let id = 0;\n\nclass Dep {\n  constructor(){\n    this.id = id++;\n    this.subs = [];\n  }\n  // 让 watcher 记住 dep（查重），再让 dep 记住 watcher\n  depend(){\n    // 相当于 watcher.addDep：使当前 watcher 记住 dep\n    Dep.target.addDep(this);  \n  }\n  // 让 dep 记住 watcher - 在 watcher 中被调用\n  addSub(watcher){\n    this.subs.push(watcher);\n  }\n  // dep 中收集的全部 watcher 依次执行更新方法 update\n  notify(){\n    this.subs.forEach(watcher => watcher.update())\n  }\n}\n\nDep.target = null;  // 静态属性，用于记录当前 watcher\n\nexport default Dep;","import { isArray, isObject } from \"../utils\";\nimport { arrayMethods } from \"./array\";\nimport Dep from \"./dep\";\n\nexport function observe(value) {\n\n  // 1，如果 value 不是对象，说明写错了，就不需要观测了，直接 return\n  // 注意：数据也是 Object，这里就不做容错判断了，忽略使用错误传入数组的情况\n  if (!isObject(value)) {\n    return;\n  }\n\n  // 通过__ob__属性判断对象是否已经被观测，如果已经被观测，就不再重复观测了；\n  if(value.__ob__){\n    return;\n  }\n  // 2，对 对象 进行观测（最外层必须是一个object!不能是数组,Vue没有这种用法）\n  return new Observer(value);\n}\n\nclass Observer {\n\n  constructor(value) {\n    // 为 Observer 实例添加 dep 用于收集依赖\n    this.dep = new Dep();// 为对象或数组本身添加了一个 dep 属性\n    // value：为数组或对象添加自定义属性__ob__ = this，\n    // this：为当前 Observer 类的实例，实例上就有 observeArray 方法；\n    // value.__ob__ = this;\t// 可被遍历枚举，会造成死循环\n    // 定义__ob__ 属性为不可被枚举，防止对象在进入walk都继续defineProperty，造成死循环\n    Object.defineProperty(value, '__ob__', {\n      value:this,\n      enumerable:false  // 不可被枚举\n    });\n    // 对 value 是数组和对象的情况分开处理\n    if (isArray(value)) {\n      value.__proto__ = arrayMethods;  // 更改数组的原型方法\n      console.log(value)\n      this.observeArray(value);\t// 数组的深层观测处理\n    } else {\n      // 如果value是对象，就循环对象，将对象中的属性使用Object.defineProperty重新定义一遍\n      this.walk(value); // 上来就走一步，这个方法的核心就是在循环对象\n    }\n  }\n\n  /**\n   * 遍历对象\n   *  循环data对象（不需要循环data原型上的方法），使用 Object.keys()\n   * @param {*} data \n   */\n  walk(data) {\n    Object.keys(data).forEach(key => {\n      // 使用Object.defineProperty重新定义data对象中的属性\n      defineReactive(data, key, data[key]);\n    });\n  }\n\n  /**\n   * 遍历数组，对数组中的对象进行递归观测\n   *  1）[[]] 数组套数组\n   *  2）[{}] 数组套对象\n   * @param {*} data \n   */\n  observeArray(data) {\n    // observe方法内，如果是对象类型，继续 new Observer 进行递归处理\n    data.forEach(item => observe(item))\n  }\n}\n\n/**\n * 使数组中的引用类型都进行依赖收集\n * @param {*} value 需要做递归依赖收集的数组\n */\nfunction dependArray(value) {\n  // 数组中如果有对象:[{}]或[[]]，也要做依赖收集（后续会为对象新增属性）\n  for(let i = 0; i < value.length; i++){\n    let current = value[i];\n    // current 上如果有__ob__，说明是对象，就让 dep 收集依赖（只有对象上才有 __ob__）\n    current.__ob__ && current.__ob__.dep.depend();\n    // 如果内部还是数组，继续递归处理\n    if(Array.isArray(current)){\n      dependArray(current)\n    }\n  }\n}\n/**\n * 给对象Obj，定义属性key，值为value\n *  使用Object.defineProperty重新定义data对象中的属性\n *  由于Object.defineProperty性能低，所以vue2的性能瓶颈也在这里\n * @param {*} obj 需要定义属性的对象\n * @param {*} key 给对象定义的属性名\n * @param {*} value 给对象定义的属性值\n */\nfunction defineReactive(obj, key, value) {\n  // childOb 是数据组进行观测后返回的结果，内部 new Observe 只处理数组或对象类型\n  let childOb = observe(value);// 递归实现深层观测\n  let dep = new Dep();  // 为每个属性添加一个 dep\n  Object.defineProperty(obj, key, {\n    // get方法构成闭包：取obj属性时需返回原值value，\n    // value会查找上层作用域的value，所以defineReactive函数不能被释放销毁\n    get() {\n      if(Dep.target){\n        // 对象属性的依赖收集\n        dep.depend();\n        // 数组或对象本身的依赖收集\n        if(childOb){  // 如果 childOb 有值，说明数据是数组或对象类型\n          // observe 方法中，会通过 new Observe 为数组或对象本身添加 dep 属性\n          childOb.dep.depend();    // 让数组和对象本身的 dep 记住当前 watcher\n          if(Array.isArray(value)){// 如果当前数据是数组类型\n            // 可能数组中继续嵌套数组，需递归处理\n            dependArray(value)\n          }  \n        }\n      }\n      return value;\n    },\n    set(newValue) { // 确保新对象为响应式数据：如果新设置的值为对象，需要再次进行劫持\n      console.log(\"修改了被观测属性 key = \" + key + \", newValue = \" + JSON.stringify(newValue))\n      if (newValue === value) return\n      observe(newValue);  // observe方法：如果是对象，会 new Observer 深层观测\n      value = newValue;\n      dep.notify(); // 通知当前 dep 中收集的所有 watcher 依次执行视图更新\n    }\n  })\n}\n","import { observe } from \"./observe\";\nimport { isFunction } from \"./utils\";\n\nexport function initState(vm) {\n    // 前面将 options 挂载到 vm.$options，这里直接可以拿到\n    const opts = vm.$options;\n\n    // 如果传了data，做数据的初始化\n    if (opts.data) {\n        initData(vm);\n    }\n    // 如果传了props，做操作...\n    // 如果传了watch，做操作...\n    // 如果传了computed，做操作...\n\n}\n\n/**\n * 代理方法\n *  当取 vm.key 时，将它代理到 vm._data上去取\n * @param {*} vm        vm 实例\n * @param {*} key       属性名\n * @param {*} source    代理目标，这里是vm._data\n */\nfunction Proxy(vm, key, source) {\n    Object.defineProperty(vm, key, {\n        get(){\n            return vm[source][key]\n        },\n        set(newValue){\n            vm[source][key] = newValue;\n        }\n    })\n}\n\nfunction initData(vm) {\n    console.log(\"进入 state.js - initData，数据初始化操作\")\n    let data = vm.$options.data;// 拿到 vue 初始化时，用户传入的data数据\n\n    // data 有可能是函数也有可能是对象，因此需要判断\n    //  如果 data 是函数，要拿到它的返回值，执行 data 函数并绑定 this 为 vm 实例\n    //  如果 data 不是函数，就是对象，不做处理\n    data = vm._data = isFunction(data) ? data.call(vm) : data;\n\n    // data 数据的响应式：遍历对象拿到所有属性，再通过Object.defineProperty 重写 data 中的所有属性  \n    // 在observe方法中new Observer执行后，数组的原型方法已完成重写,此时vm._data已经是响应式数据了\n    observe(data); // 观测数据\n    \n    // 当 vm.message 在 vm 实例上取值时，将它代理到vm._data上去取\n    for(let key in data){\n        Proxy(vm, key, '_data')\n    }\n}\n","import { nextTick } from \"../utils\";\n\nlet queue = []; // 用于缓存渲染 watcher\nlet has = {};   // 存放 watcher 唯一 id，用于 watcher 的查重\nlet pending = false;// 控制 setTimeout 只走一次\n\n/**\n * 刷新队列：执行所有 watcher.run 并将队列清空；\n */\nfunction flushschedulerQueue() {\n  // 更新前,执行生命周期：beforeUpdate\n  queue.forEach(watcher => watcher.run()) // 依次触发视图更新\n  queue = [];       // reset\n  has = {};         // reset\n  pending = false;  // reset\n  // 更新完成,执行生命周期：updated\n}\n\n/**\n * 将 watcher 进行查重并缓存，最后统一执行更新\n * @param {*} watcher 需更新的 watcher\n */\nexport function queueWatcher(watcher) {\n  let id = watcher.id;\n  if (has[id] == null) {\n    has[id] = true;\n    queue.push(watcher);  // 缓存住watcher,后续统一处理\n    if (!pending) {       // 等效于防抖\n      nextTick(flushschedulerQueue);\n      pending = true;     // 首次进入被置为 true，使微任务执行完成后宏任务才执行\n    }\n  }\n}","import Dep from \"./dep\";\nimport { queueWatcher } from \"./scheduler\";\nlet id = 0;\nclass Watcher {\n  constructor(vm, fn, cb, options){\n    this.vm = vm;\n    this.fn = fn;\n    this.cb = cb;\n    this.options = options;\n\n    this.id = id++;   // watcher 唯一标记\n    this.depsId = new Set();  // 用于当前 watcher 保存 dep 实例的唯一id\n    this.deps = []; // 用于当前 watcher 保存 dep 实例\n    this.getter = fn; // fn 为页面渲染逻辑\n    this.get();\n  }\n  addDep(dep){\n    let did = dep.id;\n    // dep 查重 \n    if(!this.depsId.has(did)){\n      // 让 watcher 记住 dep\n      this.depsId.add(did);\n      this.deps.push(dep);\n      // 让 dep 也记住 watcher\n      dep.addSub(this); \n    }\n  }\n  get(){\n    Dep.target = this;  // 在触发视图渲染前，将 watcher 记录到 Dep.target 上\n    this.getter();      // 调用页面渲染逻辑\n    Dep.target = null;  // 渲染完成后，清除 Watcher 记录\n  }\n  update(){\n    console.log(\"watcher-update\", \"查重并缓存需要更新的 watcher\")\n    queueWatcher(this);\n  }\n  run(){\n    console.log(\"watcher-run\", \"真正执行视图更新\")\n    this.get();\n  }\n}\n\nexport default Watcher;","// 参数：_c('标签', {属性}, ...儿子)\nexport function createElement(vm, tag, data={}, ...children) {\n  // 这里需要进行扩展。。。\n  \n  // 返回元素的虚拟节点（元素是没有文本的）\n  return vnode(vm, tag, data, children, data.key, undefined);\n}\nexport function createText(vm, text) {\n  // 返回文本的虚拟节点（文本没有标签、数据、儿子、key）\n  return vnode(vm, undefined, undefined, undefined, undefined, text);\n}\n\n/**\n * 判断两个虚拟节点是否是同一个虚拟节点\n *  逻辑：标签名 和 key 都相同\n * @param {*} newVnode 新虚拟节点\n * @param {*} oldVnode 老虚拟节点\n * @returns \n */\nexport function isSameVnode(newVnode, oldVnode){\n  return (newVnode.tag === oldVnode.tag)&&(newVnode.key === oldVnode.key); \n}\n// 通过函数返回vnode对象\n// 后续元素需要做 diff 算法，需要 key 标识\nfunction vnode(vm, tag, data, children, key, text) {\n  return {\n    vm,       // 谁的实例\n    tag,      // 标签\n    data,     // 数据\n    children, // 儿子\n    key,      // 标识\n    text      // 文本\n  }\n}","import { isSameVnode } from \".\";\n\n/**\n * 将虚拟节点转为真实节点后插入到元素中\n * @param {*} oldVnode  老的虚拟节点\n * @param {*} vnode     新的虚拟节点\n * @returns             新的真实元素\n */\nexport function patch(oldVnode, vnode) {\n  // console.log(\"patch-oldVnode\", oldVnode);\n  // console.log(\"patch-newVnode\", vnode);\n  const isRealElement = oldVnode.nodeType;  // 元素的节点类型是1，虚拟节点无此属性\n  if (isRealElement) {// 元素代表是真实节点\n    // 1，根据虚拟节点创建真实节点\n    const elm = createElm(vnode);\n    // 2，使用真实节点替换掉老节点\n    // 找到元素的父亲节点\n    const parentNode = oldVnode.parentNode;\n    // 找到老节点的下一个兄弟节点（nextSibling 若不存在将返回 null）\n    const nextSibling = oldVnode.nextSibling;\n    // 将新节点 elm 插入到老节点el的下一个兄弟节点 nextSibling 的前面\n    // 备注：若 nextSibling 为 null，insertBefore 等价于 appendChild\n    parentNode.insertBefore(elm, nextSibling);\n    // 删除老节点 el\n    parentNode.removeChild(oldVnode);\n    return elm;\n  } else {\n    console.log(\"patch-oldVnode\", oldVnode);\n    console.log(\"patch-newVnode\", vnode);\n    // diff：新老虚拟节点比对\n    if (!isSameVnode(oldVnode, vnode)) {// 同级比较，不是相同节点时，不考虑复用（放弃跨层复用），直接用新的替换旧的\n      return oldVnode.el.parentNode.replaceChild(createElm(vnode), oldVnode.el);\n    }\n\n    // 相同节点，就复用节点（复用老的），再更新不一样的地方（属性），注意文本要做特殊处理，文本是没有标签名的\n\n    // 文本的处理：文本直接更新就可以，因为文本没有儿子  组件中 Vue.component（‘xxx’）这就是组件的 tag\n    let el = vnode.el = oldVnode.el;  // 节点复用：将老节点el，赋值给新节点el\n    if (!oldVnode.tag) {  // 文本：没有标签名\n      if (oldVnode.text !== vnode.text) {// 文本内容变化了，更新文本内容：用新的内容更新老的内容\n        return el.textContent = vnode.text;\n      }else{\n        // 文本没变化也结束：否则会继续进入 updateProperties处理元素，再进入情况3的updateChildren\n        // 但整体影响不大，会因条件不符不执行,但做好的做法还是直接 return 掉吧\n        return; \n      }\n    }\n\n    // 元素的处理：相同节点，且新老节点不都是文本时\n    updateProperties(vnode, oldVnode.data);\n\n    // 比较儿子节点\n    let oldChildren = oldVnode.children || {};\n    let newChildren = vnode.children || {};\n    // 情况 1：老的有儿子，新的没有儿子；直接把老的 dom 元素干掉即\n    if (oldChildren.length > 0 && newChildren.length == 0) {\n      el.innerHTML = '';//暴力写法直接清空；更好的处理是封装removeChildNodes方法：将子节点全部删掉，因为子节点可能包含组件\n      // 情况 2：老的没有儿子，新的有儿子；直接将新的插入即可\n    } else if (oldChildren.length == 0 && newChildren.length > 0) {\n      newChildren.forEach((child) => {// 注意：这里的child是虚拟节点，需要变为真实节点\n        let childElm = createElm(child); // 根据新的虚拟节点，创建一个真实节点\n        el.appendChild(childElm);// 将生成的真实节点，放入 dom\n      })\n      // 情况 3：新老都有儿子\n    } else {  // 递归: updateChildren 内部调用 patch, patch, 内部还会调用 updateChildren (patch 方法是入口)\n      updateChildren(el, oldChildren, newChildren)\n    }\n\n    return el;// 返回新节点\n  }\n}\n\n\n/**\n * 新老都有儿子时做比对，即 diff 算法核心逻辑\n * 备注：采用头尾双指针的方式；优化头头、尾尾、头尾、尾头的特殊情况；\n * @param {*} el \n * @param {*} oldChildren  老的儿子节点\n * @param {*} newChildren  新的儿子节点\n */\nfunction updateChildren(el, oldChildren, newChildren) {\n  // vue2中的diff算法内部做了优化，尽量提升性能，实在不行再暴力比对\n  // 常见情况：在列表中，新增或删除某一项（用户很少在列表的中间添加一项）\n\n  // 声明头尾指针\n  let oldStartIndex = 0;\n  let oldStartVnode = oldChildren[0];\n  let oldEndIndex = oldChildren.length - 1;\n  let oldEndVnode = oldChildren[oldEndIndex];\n\n  let newStartIndex = 0;\n  let newStartVnode = newChildren[0];\n  let newEndIndex = newChildren.length - 1;\n  let newEndVnode = newChildren[newEndIndex];\n\n  /**\n   * 根据children创建映射\n   */\n  function makeKeyByIndex(children) {\n     let map = {}\n     children.forEach((item, index)=>{\n       map[item.key] = index;\n     })\n     return map\n  }\n\n  let mapping = makeKeyByIndex(oldChildren);\n\n  // while 循环处理，所以 diff 算法的复杂度为O(n)，只循环一遍\n  // 循环结束条件：有一方遍历完了就结束；即\"老的头指针和尾指针重合\"或\"新的头指针和尾指针重合\"\n  // 备注: 此while循环中主要对4种特殊情况进行优化处理,包括：头头、尾尾、头尾、尾头\n  while (oldStartIndex <= oldEndIndex && newStartIndex <= newEndIndex) {\n    // 当前循环开始时，先处理当前的oldStartVnode和oldEndVnode为空的情况； 原因：节点之前被移走时置空，直接跳过\n    if(!oldStartVnode){\n      oldStartVnode = oldChildren[++oldStartIndex];\n    }else if(!oldEndVnode){\n      oldEndVnode = oldChildren[--oldEndIndex];\n    // 头头比较：比较新老开始节点\n    } else if (isSameVnode(oldStartVnode, newStartVnode)) {\n      // isSameVnode只能判断标签和key是否一样，但还有可能属性不一样\n      // 所以还需要使用patch方法比对新老虚拟节点的属性，\n      // 而patch方法是递归比对的，同时还会递归比较子节点\n      patch(oldStartVnode, newStartVnode);\n      // 更新新老头指针和新老头节点\n      oldStartVnode = oldChildren[++oldStartIndex];\n      newStartVnode = newChildren[++newStartIndex];\n    // 尾尾比较：比较新老末尾节点\n    }else if(isSameVnode(oldEndVnode, newEndVnode)){\n      patch(oldEndVnode, newEndVnode);\n      oldEndVnode = oldChildren[--oldEndIndex];\n      newEndVnode = newChildren[--newEndIndex];\n    // 头尾比较：老的头节点和新的尾节点做对比\n    }else if(isSameVnode(oldStartVnode, newEndVnode)){\n      // patch方法只会duff比较并更新属性，但元素的位置不会变化\n      patch(oldStartVnode, newEndVnode);// diff:包括递归比儿子\n      // 移动节点：将当前的节点插入到最后一个节点的下一个节点的前面去\n      el.insertBefore(oldStartVnode.el, oldEndVnode.el.nextSibling);\n      // 移动指针\n      oldStartVnode = oldChildren[++oldStartIndex];\n      newEndVnode = newChildren[--newEndIndex];\n    // 尾头比较\n    }else if(isSameVnode(oldEndVnode, newStartVnode)){\n      patch(oldEndVnode, newStartVnode);  // patch方法只会更新属性，元素的位置不会变化\n      // 移动节点:将老的尾节点移动到老的头节点前面去\n      el.insertBefore(oldEndVnode.el, oldStartVnode.el);// 将尾部插入到头部\n      // 移动指针\n      oldEndVnode = oldChildren[--oldEndIndex];\n      newStartVnode = newChildren[++newStartIndex];\n    }else{\n      // 前面4种逻辑（头头、尾尾、头尾、尾头）,主要是考虑到用户使用时的一些特殊场景，但也有非特殊情况，如：乱序排序\n      // 筛查当前新的头指针对应的节点在mapping中是否存在\n      let moveIndex = mapping[newStartVnode.key]\n      if(moveIndex == undefined){// 没有，将当前比对的新节点插入到老的头指针对用的节点前面\n        // 将当前新的虚拟节点创建为真实节点，插入到老的开始节点前面\n        el.insertBefore(createElm(newStartVnode), oldStartVnode.el);\n      }else{  // 有,需要复用\n        // 将当前比对的老节点移动到老的头指针前面\n        let moveVnode = oldChildren[moveIndex];// 从老的队列中找到可以被复用的这个节点\n        // 复用：更新复用节点的属性，插入对应位置\n        patch(moveVnode, newStartVnode)\n        el.insertBefore(moveVnode.el, oldStartVnode.el);\n        // 由于复用的节点在oldChildren中被移走了,之前的位置要标记为空(指针移动时，跳过会使用)\n        oldChildren[moveIndex] = undefined;\n      }\n      // 每次处理完成后，新节点的头指针都需要向后移动\n      // 备注：\n      // \t\t无论节点是否可复用，新指针都会向后移动，所以最后统一处理；\n      //    节点可复用时，老节点的指针移动会在4种特殊情况中被处理完成；\n      newStartVnode = newChildren[++newStartIndex];\n    }\n  }\n\n  // 至此，完成了相同节点的比较，下面开始处理不同的节点\n\n  // 1，新的多（以新指针为参照）插入新增的\n  if (newStartIndex <= newEndIndex) {\n    // 新的开始指针和新的结束指针之间的节点\n    for (let i = newStartIndex; i <= newEndIndex; i++) {\n      // 判断当前尾节点的下一个元素是否存在：\n      //  1，如果存在：则插入到下一个元素的前面\n      //  2，如果不存在（下一个是 null） ：就是 appendChild\n      // 取参考节点anchor:决定新节点放到前边还是后边\n      //  逻辑：取去newChildren的尾部+1,判断是否为 null\n      //  解释：如果有值说明是向前移动的，取出此虚拟元素的真实节点el，将新节点添加到此真实节点前即可\n      let anchor = newChildren[newEndIndex + 1] == null ? null : newChildren[newEndIndex + 1].el\n      // // 获取对应的虚拟节点，并生成真实节点，添加到 dom 中\n      // el.appendChild(createElm(newChildren[i]))\n      // 逻辑合并:将 appendChild 改为 insertBefore\n      //  效果：既有appendChild又有insertBefore的功能，直接将参考节点放进来即可;\n      //  解释：对于insertBefore方法,如果anchor为null，等同于appendChild;如果有值，则是insertBefore;\n      el.insertBefore(createElm(newChildren[i]),anchor)\n    }\n  }\n  // 2，旧的多，（以旧指针为参照）删除多余的真实节点\n  if(oldStartIndex <= oldEndIndex){\n    for(let i = oldStartIndex; i <= oldEndIndex; i++){\n      let child = oldChildren[i];\n      // child有值时才删除；原因：节点有可能在移走时被置为undefined\n      child && el.removeChild(child.el);\n    }\n  }\n}\n\n// 面试：虚拟节点的实现？如何将虚拟节点渲染成真实节点\nexport function createElm(vnode) {\n  // 虚拟节点必备的三个：标签，数据，孩子\n  let { tag, data, children, text, vm } = vnode;\n\n  // vnode.el:绑定真实节点与虚拟节点的映射关系，便于后续的节点更新操作\n  if (typeof tag === 'string') { // 元素\n    // 处理当前元素节点\n    vnode.el = document.createElement(tag) // 创建元素的真实节点\n    updateProperties(vnode, data)  // 处理元素的 data 属性\n    // 处理当前元素节点的儿子：递归创建儿子的真实节点，并添加到对应的父亲中\n    children.forEach(child => { // 若不存在儿子，children为空数组\n      vnode.el.appendChild(createElm(child))\n    });\n  } else { // 文本：文本中 tag 是 undefined\n    vnode.el = document.createTextNode(text)  // 创建文本的真实节点\n  }\n  return vnode.el;\n}\n\n// 循环 data 添加到 el 的属性上\n// 后续 diff 算法时进行完善，没有考虑样式等\nfunction updateProperties(vnode, oldProps = {}) {\n  // 1,初次渲染，用oldProps给vnode的 el 赋值即可\n  // 2,更新逻辑，拿到老的props和vnode中的 data 进行比对\n  let el = vnode.el; // dom上的真实节点（上边复用老节点时已经赋值了）\n  let newProps = vnode.data || {};  // 拿到新的数据\n\n  let newStyle = newProps.style || {};\n  let oldStyle = oldProps.style || {};\n\n  //如果老的样式有，新的没有，就删掉\n  for (let key in oldStyle) { // 老的样式有，新的没有，就把页面上的样式删除掉\n    if (!newStyle[key]) {\n      el.style[key] = '';\n    }\n  }\n\n  // 新旧比对：两个对象比对差异\n  for (let key in newProps) { // 直接用新的盖掉老的就可以了  还要注意：老的里面有，可能新的里面没有了\n    // 前后两次一样，浏览器会检测，就不会更新了，不会有性能问题\n    // console.log(newProps)\n    if (key == 'style') { // 新的里面有样式，直接覆盖即可\n      for (let key in newStyle) { // 老的样式有，新的没有，就把页面上的样式删除掉\n        console.log(\"更新style\", el.style[key], newStyle[key])\n        el.style[key] = newStyle[key]\n      }\n    } else {\n      el.setAttribute(key, newProps[key])\n    }\n  }\n  // 处理老的里面有，可能新的里面没有的情况，需要再删掉\n  for (let key in oldProps) {\n    if (!newProps[key]) {\n      el.removeAttribute(key)\n    }\n  }\n}","import Watcher from \"./observe/watcher\";\nimport { patch } from \"./vdom/patch\";\n\nexport function mountComponent(vm) {\n  // vm._render()：调用 render 方法\n  // vm._update：将虚拟节点更新到页面上\n  // 初始化流程\n  // vm._update(vm._render());  \n  // 改造\n  let updateComponent = ()=>{\n    vm._update(vm._render());  \n  }\n\n  // 当视图渲染前，调用钩子: beforeCreate\n  callHook(vm, 'beforeCreate');\n\n  // 渲染 watcher ：每个组件都有一个 watcher\n  new Watcher(vm, updateComponent, ()=>{\n    console.log('Watcher-update')\n    // 视图更新后，调用钩子: created\n    callHook(vm, 'created');\n  },true)\n\n   // 当视图挂载完成，调用钩子: mounted\n   callHook(vm, 'mounted');\n}\n\nexport function lifeCycleMixin(Vue){\n  Vue.prototype._update = function (vnode) {\n    console.log(\"_update-vnode\",vnode)\n    const vm = this;\n    // 取上一次的 preVnode\n    let preVnode = vm.preVnode;\n    // 渲染前，先保存当前 vnode\n    vm.preVnode = vnode;\n    // preVnode 有值，说明已经有节点了，本次是更新渲染；没值就是初渲染\n    if(!preVnode){// 初渲染\n      // 传入当前真实元素vm.$el，虚拟节点vnode，返回新的真实元素\n      vm.$el = patch(vm.$el, vnode);\n    }else{// 更新渲染:新老虚拟节点做 diff 比对\n      vm.$el = patch(preVnode, vnode);\n    }\n  }\n}\n\n/**\n * 执行生命周期钩子\n *    从$options取对应的生命周期函数数组并执行\n * @param {*} vm    vue实例\n * @param {*} hook  生命周期\n */\nexport function callHook(vm, hook){\n  // 获取生命周期对应函数数组\n  let handlers = vm.$options[hook];\n  if(handlers){\n    handlers.forEach(fn => {\n      fn.call(vm);  // 生命周期中的 this 指向 vm 实例\n    })\n  }\n}","import { compileToFunction } from \"./compiler\";\nimport { initState } from \"./state\";\nimport { mountComponent } from \"./lifecycle\";\nimport { mergeOptions, nextTick } from \"./utils\";\n\nexport function initMixin(Vue) {\n  // 在Vue原型上扩展一个原型方法_init,进行vue初始化\n  Vue.prototype._init = function (options) {\n    const vm = this;  // this 指向当前 vue 实例\n    // vm.$options = options; // 将 Vue 实例化时用户传入的options暴露到vm实例上\n    // 此时需使用 options 与 mixin 合并后的全局 options 再进行一次合并\n    debugger\n    vm.$options = mergeOptions(vm.constructor.options, options);\n    // 目前在 vue 实例化时，传入的 options 只有 el 和 data 两个参数\n    initState(vm);  // 状态的初始化\n    if (vm.$options.el) {\n      // 将数据挂在到页面上（此时,数据已经被劫持）\n      vm.$mount(vm.$options.el)\n    }\n  }\n\n  // 支持 new Vue({el}) 和 new Vue().$mount 两种情况\n  Vue.prototype.$mount = function (el) {\n    console.log(\"***** 进入 $mount，el = \" + el + \"*****\")\n    const vm = this;\n    const opts = vm.$options;\n    el = document.querySelector(el); // 获取真实的元素\n    vm.$el = el; // vm.$el 表示当前页面上的真实元素\n    console.log(\"获取真实的元素，el = \" + el)\n\n    // 如果没有 render, 看 template\n    if (!opts.render) {\n      console.log(\"options 中没有 render , 继续取 template\")\n      // 如果没有 template, 采用元素内容\n      let template = opts.template;\n      if (!template) {\n        console.log(\"options 中没有 template, 取 el.outerHTML = \" + el.outerHTML)\n        // 拿到整个元素标签,将模板编译为 render 函数\n        template = el.outerHTML;\n      }else{\n        console.log(\"options 中有 template = \" + template)\n      }\n\n      let render = compileToFunction(template);\n      opts.render = render;\n      console.log(\"打印 compileToFunction 返回的 render = \" + render.toString())\n    }\n\n    // 将 render 渲染到 el 上\n    mountComponent(vm);\n  }\n\n  Vue.prototype.$nextTick = nextTick;\n}\n","import { isObject } from \"./utils\"\nimport { createElement, createText } from \"./vdom\"\n\nexport function renderMixin(Vue) {\n  Vue.prototype._c = function () {  // createElement 创建元素型的节点\n    const vm = this;\n    return createElement(vm, ...arguments); // 传入 vm 及之前的所有参数\n  }\n  Vue.prototype._v = function (text) {  // 创建文本的虚拟节点\n    const vm = this;\n    return createText(vm, text);\n  }\n  Vue.prototype._s = function (val) {  // JSON.stringify\n    if(isObject(val)){  // 是对象就转成字符串\n      return JSON.stringify(val)\n    } else {  // 不是对象就直接返回\n      return val\n    }\n  }\n  Vue.prototype._render = function () {\n    const vm = this;  // vm 中有所有数据  vm.xxx => vm._data.xxx\n    let { render } = vm.$options;\n    let vnode = render.call(vm);  // 此时内部会调用_c,_v,_s，执行完成后返回虚拟节点\n    return vnode\n  }\n}","import { compileToFunction } from \"./compiler\";\nimport { initGlobalAPI } from \"./global-api\";\nimport { initMixin } from \"./init\";\nimport { lifeCycleMixin } from \"./lifecycle\";\nimport { renderMixin } from \"./render\";\nimport { createElm, patch } from \"./vdom/patch\";\n\n/**\n * 在vue 中所有的功能都通过原型扩展（原型模式）的方式来添加\n * @param {*} options vue 实例化传入的配置对象\n */\nfunction Vue(options) {\n    this._init(options);  // 调用Vue原型上的方法_init\n}\n\ninitMixin(Vue)\nrenderMixin(Vue)   // 混合一个 render 方法\nlifeCycleMixin(Vue)\ninitGlobalAPI(Vue) // 初始化 global Api\n\n// // 1,生成第一个虚拟节点\n// // new Vue会对数据进行劫持\n// let vm1 = new Vue({\n//     data() {\n//         return { name: 'Brave' }\n//     }\n// })\n// // 将模板 render1 生成为 render 函数\n// // let render1 = compileToFunction('<div>{{name}}</div>');// 调用 compileToFunction，将模板生成 render 函数，会解析模板，最终包成一个 function\n// // let render1 = compileToFunction('<div id=\"a\">{{name}}</div>');\n// // let render1 = compileToFunction('<div style=\"color:blue\">{{name}}</div>');\n// let render1 = compileToFunction(`<div>\n//     <li key=\"A\">A</li>\n//     <li key=\"B\">B</li>\n//     <li key=\"C\">C</li>\n//     <li key=\"D\">D</li>\n// </div>`);\n// // 调用 render 函数，产生虚拟节点\n// let oldVnode = render1.call(vm1)    // oldVnode:第一次的虚拟节点\n// // 将虚拟节点生成真实节点\n// let el1 = createElm(oldVnode);\n// // 将真实节点渲染到页面上\n// document.body.appendChild(el1);\n// // 2，生成第二个虚拟节点\n// let vm2 = new Vue({\n//     data() {\n//         return { name: 'BraveWang' }\n//     }\n// })\n// // let render2 = compileToFunction('<p>{{name}}</p>');\n// // let render2 = compileToFunction('<div class=\"b\">{{name}}</div>');\n// // let render2 = compileToFunction('<div style=\"color:red\">{{name}}</div>');\n// // let render2 = compileToFunction(`<div>\n// //     <li key=\"D\" style=\"color:pink\">D</li>\n// //     <li key=\"C\" style=\"color:yellow\">C</li>\n// //     <li key=\"B\" style=\"color:blue\">B</li>\n// //     <li key=\"A\" style=\"color:red\">A</li>\n// // </div>`);\n// let render2 = compileToFunction(`<div>\n//     <li key=\"A\" style=\"color:red\">A</li>\n//     <li key=\"B\" style=\"color:blue\">B</li>\n//     <li key=\"C\" style=\"color:yellow\">C</li>\n//     <li key=\"D\" style=\"color:pink\">D</li>\n//     <li key=\"E\">E</li>\n//     <li key=\"F\">F</li>\n// </div>`);\n// // let render2 = compileToFunction(`<div>\n// //     <li key=\"F\" style=\"color:pink\">F</li>\n// //     <li key=\"B\" style=\"color:yellow\">B</li>\n// //     <li key=\"A\" style=\"color:blue\">A</li>\n// //     <li key=\"E\" style=\"color:red\">E</li>\n// //     <li key=\"P\" style=\"color:red\">P</li>\n// // </div>`);\n// let newVnode = render2.call(vm2);\n// // 延迟看效果：初始化完成显示 el1，1 秒后移除 el1 显示 el2\n// setTimeout(() => {\n//     // let el2 = createElm(newVnode);\n//     // document.body.removeChild(el1);\n//     // document.body.appendChild(el2);\n//     patch(oldVnode, newVnode);  // 内部会做递归处理\n// }, 2000);\n\n// // 3，调用 patch 方法进行比对\n// // let vm = new Vue({\n// //     data(){\n// //         return {name:'Brave'}\n// //     }\n// // })\n// // let render = compileToFunction('<div>{{name}}</div>');\n// // let oldVnode = render.call(vm)\n// // let el = createElm(oldVnode);\n// // document.body.appendChild(el);\n// // // 数据更新后，再次调用 render 函数\n// // vm.name = 'BraveWang';\n// // let newVnode = render.call(vm);\n// // console.log(oldVnode, newVnode);\n// // setTimeout(()=>{\n// //     // 比对新老虚拟节点的差异，更新需要更新的节点（性能高）\n// //     patch(oldVnode, newVnode); \n// // }, 1000);\n\n// 导出 Vue 函数供外部使用\nexport default Vue;"],"names":["ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","parserHTML","html","console","log","stack","root","createASTElement","tag","attrs","parent","type","children","start","JSON","stringify","length","element","push","end","tagName","pop","text","chars","replace","advance","len","substring","parseStartTag","match","attr","name","value","index","indexOf","startTagMatch","endTagMatch","genProps","str","i","styles","arguments","slice","defaultTagRE","gen","el","generate","test","lastIndex","tokens","exec","preText","trim","lastText","join","genChildren","result","map","item","ast","code","compileToFunction","template","render","Function","isFunction","val","isObject","isArray","Array","callbacks","waiting","flushsCallbacks","forEach","fn","nextTick","Promise","resolve","then","strats","lifeCycle","hook","parentVal","childVal","concat","components","res","Object","create","key","mergeOptions","options","mergeFiled","hasOwnProperty","strat","initGlobalAPI","Vue","mixin","extend","opt","Super","Sub","_init","prototype","constructor","component","id","definition","oldArrayPrototype","arrayMethods","methods","method","args","call","inserted","ob","__ob__","observeArray","dep","notify","Dep","subs","depend","target","addDep","addSub","watcher","update","observe","Observer","defineProperty","enumerable","__proto__","walk","data","keys","defineReactive","dependArray","current","obj","childOb","get","set","newValue","initState","vm","opts","$options","initData","Proxy","source","_data","queue","has","pending","flushschedulerQueue","run","queueWatcher","Watcher","cb","depsId","Set","deps","getter","did","add","createElement","vnode","undefined","createText","isSameVnode","newVnode","oldVnode","patch","isRealElement","nodeType","elm","createElm","parentNode","nextSibling","insertBefore","removeChild","replaceChild","textContent","updateProperties","oldChildren","newChildren","innerHTML","child","childElm","appendChild","updateChildren","oldStartIndex","oldStartVnode","oldEndIndex","oldEndVnode","newStartIndex","newStartVnode","newEndIndex","newEndVnode","makeKeyByIndex","mapping","moveIndex","moveVnode","anchor","document","createTextNode","oldProps","newProps","newStyle","style","oldStyle","setAttribute","removeAttribute","mountComponent","updateComponent","_update","_render","callHook","lifeCycleMixin","preVnode","$el","handlers","initMixin","$mount","querySelector","outerHTML","toString","$nextTick","renderMixin","_c","_v","_s"],"mappings":";;;;;;EACA;EACA,MAAMA,MAAM,GAAI,8BAAhB;;EAEA,MAAMC,YAAY,GAAI,OAAMD,MAAO,QAAOA,MAAO,GAAjD;;EAEA,MAAME,YAAY,GAAG,IAAIC,MAAJ,CAAY,KAAIF,YAAa,EAA7B,CAArB;;EAEA,MAAMG,MAAM,GAAG,IAAID,MAAJ,CAAY,QAAOF,YAAa,QAAhC,CAAf;;EAEA,MAAMI,SAAS,GAAG,2EAAlB;;EAEA,MAAMC,aAAa,GAAG,YAAtB;EAIO,SAASC,UAAT,CAAoBC,IAApB,EAA0B;EAC/BC,EAAAA,OAAO,CAACC,GAAR,CAAY,0CAAZ;EACA,MAAIC,KAAK,GAAG,EAAZ;EACA,MAAIC,IAAI,GAAG,IAAX,CAH+B;;EAK/B,WAASC,gBAAT,CAA0BC,GAA1B,EAA+BC,KAA/B,EAAsCC,MAAtC,EAA8C;EAC5C,WAAO;EACLF,MAAAA,GADK;EACC;EACNG,MAAAA,IAAI,EAAC,CAFA;EAEG;EACRC,MAAAA,QAAQ,EAAC,EAHJ;EAGS;EACdF,MAAAA,MAJK;EAIG;EACRD,MAAAA,KALK;;EAAA,KAAP;EAOD,GAb8B;;;EAe/B,WAASI,KAAT,CAAeL,GAAf,EAAoBC,KAApB,EAA2B;EACzBN,IAAAA,OAAO,CAACC,GAAR,CAAY,4BAA4BI,GAA5B,GAAkC,WAAlC,GAAgDM,IAAI,CAACC,SAAL,CAAeN,KAAf,CAA5D,EADyB;;EAGzB,QAAIC,MAAM,GAAGL,KAAK,CAACA,KAAK,CAACW,MAAN,GAAa,CAAd,CAAlB;EACA,QAAIC,OAAO,GAAGV,gBAAgB,CAACC,GAAD,EAAMC,KAAN,EAAaC,MAAb,CAA9B,CAJyB;;EAMzB,QAAGJ,IAAI,IAAI,IAAX,EAAiBA,IAAI,GAAGW,OAAP;;EACjB,QAAGP,MAAH,EAAU;EAAE;EACVO,MAAAA,OAAO,CAACP,MAAR,GAAiBA,MAAjB,CADQ;;EAERA,MAAAA,MAAM,CAACE,QAAP,CAAgBM,IAAhB,CAAqBD,OAArB,EAFQ;EAGT;;EACDZ,IAAAA,KAAK,CAACa,IAAN,CAAWD,OAAX;EACD,GA3B8B;;;EA6B/B,WAASE,GAAT,CAAaC,OAAb,EAAsB;EACpBjB,IAAAA,OAAO,CAACC,GAAR,CAAY,8BAA8BgB,OAA1C,EADoB;;EAGpB,QAAItB,MAAM,GAAGO,KAAK,CAACgB,GAAN,EAAb,CAHoB;;EAKpB,QAAGvB,MAAM,CAACU,GAAP,IAAcY,OAAjB,EAAyBjB,OAAO,CAACC,GAAR,CAAY,MAAZ;EAC1B,GAnC8B;;;EAqC/B,WAASkB,IAAT,CAAcC,KAAd,EAAqB;EACnBpB,IAAAA,OAAO,CAACC,GAAR,CAAY,2BAA2BmB,KAAvC,EADmB;;EAGnB,QAAIb,MAAM,GAAGL,KAAK,CAACA,KAAK,CAACW,MAAN,GAAa,CAAd,CAAlB;EACAO,IAAAA,KAAK,GAAGA,KAAK,CAACC,OAAN,CAAc,KAAd,EAAqB,EAArB,CAAR,CAJmB;;EAKnB,QAAGD,KAAH,EAAS;EACPb,MAAAA,MAAM,CAACE,QAAP,CAAgBM,IAAhB,CAAqB;EACnBP,QAAAA,IAAI,EAAC,CADc;EACX;EACRW,QAAAA,IAAI,EAACC;EAFc,OAArB;EAID;EACF;EACD;EACF;EACA;EACA;;;EACE,WAASE,OAAT,CAAiBC,GAAjB,EAAsB;EACpBxB,IAAAA,IAAI,GAAGA,IAAI,CAACyB,SAAL,CAAeD,GAAf,CAAP;EACAvB,IAAAA,OAAO,CAACC,GAAR,CAAY,mBAAmBF,IAA/B;EACAC,IAAAA,OAAO,CAACC,GAAR,CAAY,iCAAZ;EACD;EAED;EACF;EACA;;;EACE,WAASwB,aAAT,GAAyB;EACvBzB,IAAAA,OAAO,CAACC,GAAR,CAAY,8CAA8CF,IAA9C,GAAqD,OAAjE,EADuB;;EAGvB,UAAMW,KAAK,GAAGX,IAAI,CAAC2B,KAAL,CAAWjC,YAAX,CAAd;;EACA,QAAGiB,KAAH,EAAS;EAAC;EACR;EACA,YAAMgB,KAAK,GAAG;EACZT,QAAAA,OAAO,EAAEP,KAAK,CAAC,CAAD,CADF;EAEZJ,QAAAA,KAAK,EAAE;EAFK,OAAd;EAIAN,MAAAA,OAAO,CAACC,GAAR,CAAY,iCAAiCU,IAAI,CAACC,SAAL,CAAec,KAAf,CAA7C,EANO;;EAQPJ,MAAAA,OAAO,CAACZ,KAAK,CAAC,CAAD,CAAL,CAASG,MAAV,CAAP;EACA,UAAIG,GAAJ,CATO;;EAUP,UAAIW,IAAJ,CAVO;EAWP;EACA;EACA;;EACA,aAAO,EAAEX,GAAG,GAAGjB,IAAI,CAAC2B,KAAL,CAAW7B,aAAX,CAAR,MAAuC8B,IAAI,GAAG5B,IAAI,CAAC2B,KAAL,CAAW9B,SAAX,CAA9C,CAAP,EAA6E;EAC3E;EACAI,QAAAA,OAAO,CAACC,GAAR,CAAY,kBAAkBU,IAAI,CAACC,SAAL,CAAee,IAAf,CAA9B,EAF2E;;EAI3ED,QAAAA,KAAK,CAACpB,KAAN,CAAYS,IAAZ,CAAiB;EAAEa,UAAAA,IAAI,EAAED,IAAI,CAAC,CAAD,CAAZ;EAAiBE,UAAAA,KAAK,EAAEF,IAAI,CAAC,CAAD,CAAJ,IAAWA,IAAI,CAAC,CAAD,CAAf,IAAsBA,IAAI,CAAC,CAAD;EAAlD,SAAjB;EACAL,QAAAA,OAAO,CAACK,IAAI,CAAC,CAAD,CAAJ,CAAQd,MAAT,CAAP,CAL2E;EAM5E,OApBM;EAsBP;;;EACA,UAAIG,GAAJ,EAAS;EACPhB,QAAAA,OAAO,CAACC,GAAR,CAAY,wCAAwCU,IAAI,CAACC,SAAL,CAAeI,GAAf,CAApD;EACAM,QAAAA,OAAO,CAACN,GAAG,CAAC,CAAD,CAAH,CAAOH,MAAR,CAAP;EACD,OA1BM;;;EA6BPb,MAAAA,OAAO,CAACC,GAAR,CAAY,qCAAqCU,IAAI,CAACC,SAAL,CAAec,KAAf,CAAjD;EACA,aAAOA,KAAP;EACD;;EACD1B,IAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ;EACAD,IAAAA,OAAO,CAACC,GAAR,CAAY,iCAAZ;EACA,WAAO,KAAP;EACD,GArG8B;;;EAwG/B,SAAOF,IAAP,EAAa;EACX;EACA,QAAI+B,KAAK,GAAG/B,IAAI,CAACgC,OAAL,CAAa,GAAb,CAAZ;;EACA,QAAID,KAAK,IAAI,CAAb,EAAgB;EAAC;EACf9B,MAAAA,OAAO,CAACC,GAAR,CAAY,aAAaF,IAAb,GAAoB,SAAhC,EADc;;EAGd,YAAMiC,aAAa,GAAGP,aAAa,EAAnC,CAHc;;EAId,UAAIO,aAAJ,EAAmB;EAAG;EACpB;EACAtB,QAAAA,KAAK,CAACsB,aAAa,CAACf,OAAf,EAAwBe,aAAa,CAAC1B,KAAtC,CAAL;EACA,iBAHiB;EAIlB,OARa;;;EAUd,UAAI2B,WAAJ;;EACA,UAAIA,WAAW,GAAGlC,IAAI,CAAC2B,KAAL,CAAW/B,MAAX,CAAlB,EAAsC;EAAC;EACrC;EACAqB,QAAAA,GAAG,CAACiB,WAAW,CAAC,CAAD,CAAZ,CAAH;EACAX,QAAAA,OAAO,CAACW,WAAW,CAAC,CAAD,CAAX,CAAepB,MAAhB,CAAP;EACA,iBAJoC;EAKrC;EACF,KAjBD,MAiBO;EAAC;EACNb,MAAAA,OAAO,CAACC,GAAR,CAAY,aAAaF,IAAb,GAAoB,SAAhC;EACD,KAtBU;;;EAyBX,QAAG+B,KAAK,GAAG,CAAX,EAAa;EACX;EACA,UAAIV,KAAK,GAAGrB,IAAI,CAACyB,SAAL,CAAe,CAAf,EAAiBM,KAAjB,CAAZ,CAFW;;EAGXX,MAAAA,IAAI,CAACC,KAAD,CAAJ;EACAE,MAAAA,OAAO,CAACF,KAAK,CAACP,MAAP,CAAP;EACD;EACF;;EACDb,EAAAA,OAAO,CAACC,GAAR,CAAY,wBAAZ;EACA,SAAOE,IAAP;EACD;;ECvJD,SAAS+B,QAAT,CAAkB5B,KAAlB,EAAyB;EACvB,MAAI6B,GAAG,GAAG,EAAV;;EACA,OAAI,IAAIC,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAE9B,KAAK,CAACO,MAAxB,EAAgCuB,CAAC,EAAjC,EAAoC;EAClC,QAAIT,IAAI,GAAGrB,KAAK,CAAC8B,CAAD,CAAhB;;EAEA,QAAGT,IAAI,CAACC,IAAL,IAAa,OAAhB,EAAwB;EAAE;EACxB,UAAIS,MAAM,GAAG,EAAb,CADsB;EAGtB;EACA;;EACAV,MAAAA,IAAI,CAACE,KAAL,CAAWR,OAAX,CAAmB,oBAAnB,EAAyC,YAAY;EACnDgB,QAAAA,MAAM,CAACC,SAAS,CAAC,CAAD,CAAV,CAAN,GAAuBA,SAAS,CAAC,CAAD,CAAhC;EACD,OAFD;EAGAX,MAAAA,IAAI,CAACE,KAAL,GAAaQ,MAAb;EACD;;EACDF,IAAAA,GAAG,IAAK,GAAER,IAAI,CAACC,IAAK,IAAGjB,IAAI,CAACC,SAAL,CAAee,IAAI,CAACE,KAApB,CAA2B,GAAlD,CAbkC;EAcnC;;EACD,SAAQ,IAAGM,GAAG,CAACI,KAAJ,CAAU,CAAV,EAAa,CAAC,CAAd,CAAiB,GAA5B,CAjBuB;EAkBvB;;EAEF,MAAMC,YAAY,GAAG,0BAArB;;EAEA,SAASC,GAAT,CAAaC,EAAb,EAAiB;EACf1C,EAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ,EAAoCyC,EAApC;;EACA,MAAGA,EAAE,CAAClC,IAAH,IAAW,CAAd,EAAgB;EAAC;EACfR,IAAAA,OAAO,CAACC,GAAR,CAAY,gBAAcyC,EAAE,CAACrC,GAAjB,GAAqB,iBAAjC;EACA,WAAOsC,QAAQ,CAACD,EAAD,CAAf,CAFc;EAGf,GAHD,MAGK;EAAC;EACJ,QAAIvB,IAAI,GAAGuB,EAAE,CAACvB,IAAd;EACAnB,IAAAA,OAAO,CAACC,GAAR,CAAY,iBAAiBkB,IAA7B;;EACA,QAAG,CAACqB,YAAY,CAACI,IAAb,CAAkBzB,IAAlB,CAAJ,EAA4B;EAC1B,aAAQ,OAAMA,IAAK,IAAnB,CAD0B;EAE3B,KAFD,MAEK;EACH;EACA;EACA,UAAI0B,SAAS,GAAGL,YAAY,CAACK,SAAb,GAAyB,CAAzC;EACA,UAAIC,MAAM,GAAG,EAAb,CAJG;;EAKH,UAAIpB,KAAJ;;EACA,aAAMA,KAAK,GAAGc,YAAY,CAACO,IAAb,CAAkB5B,IAAlB,CAAd,EAAsC;EACpCnB,QAAAA,OAAO,CAACC,GAAR,CAAY,SAASkB,IAArB;EACA,YAAIW,KAAK,GAAGJ,KAAK,CAACI,KAAlB,CAFoC;;EAGpC9B,QAAAA,OAAO,CAACC,GAAR,CAAY,qBAAqB4C,SAAjC;EACA7C,QAAAA,OAAO,CAACC,GAAR,CAAY,uBAAuB6B,KAAnC;;EACA,YAAGA,KAAK,GAAGe,SAAX,EAAqB;EAAG;EACtB,cAAIG,OAAO,GAAG7B,IAAI,CAACoB,KAAL,CAAWM,SAAX,EAAsBf,KAAtB,CAAd;EACA9B,UAAAA,OAAO,CAACC,GAAR,CAAY,wBAAwB+C,OAApC;EACAF,UAAAA,MAAM,CAAC/B,IAAP,CAAYJ,IAAI,CAACC,SAAL,CAAeoC,OAAf,CAAZ,EAHmB;EAIpB;;EAEDhD,QAAAA,OAAO,CAACC,GAAR,CAAY,YAAYyB,KAAK,CAAC,CAAD,CAAL,CAASuB,IAAT,EAAxB,EAXoC;;EAapCH,QAAAA,MAAM,CAAC/B,IAAP,CAAa,MAAKW,KAAK,CAAC,CAAD,CAAL,CAASuB,IAAT,EAAgB,GAAlC,EAboC;;EAepCJ,QAAAA,SAAS,GAAGf,KAAK,GAAGJ,KAAK,CAAC,CAAD,CAAL,CAASb,MAA7B,CAfoC;EAgBrC,OAtBE;;;EAyBH,UAAGgC,SAAS,GAAG1B,IAAI,CAACN,MAApB,EAA2B;EACzB,YAAIqC,QAAQ,GAAG/B,IAAI,CAACoB,KAAL,CAAWM,SAAX,CAAf;EACA7C,QAAAA,OAAO,CAACC,GAAR,CAAY,yBAAuBiD,QAAnC;EACAJ,QAAAA,MAAM,CAAC/B,IAAP,CAAYJ,IAAI,CAACC,SAAL,CAAesC,QAAf,CAAZ,EAHyB;EAI1B;;EAED,aAAQ,MAAKJ,MAAM,CAACK,IAAP,CAAY,GAAZ,CAAiB,GAA9B;EACD;EACF;EACF;;EAED,SAASC,WAAT,CAAqBV,EAArB,EAAyB;EACvB1C,EAAAA,OAAO,CAACC,GAAR,CAAY,yBAAZ;EACA,MAAIQ,QAAQ,GAAGiC,EAAE,CAACjC,QAAlB;;EACA,MAAGA,QAAH,EAAY;EACVT,IAAAA,OAAO,CAACC,GAAR,CAAY,2BAAZ,EAAyCQ,QAAzC;EACA,QAAI4C,MAAM,GAAG5C,QAAQ,CAAC6C,GAAT,CAAaC,IAAI,IAAId,GAAG,CAACc,IAAD,CAAxB,EAAgCJ,IAAhC,CAAqC,GAArC,CAAb;EACAnD,IAAAA,OAAO,CAACC,GAAR,CAAY,sBAAsBU,IAAI,CAACC,SAAL,CAAeyC,MAAf,CAAlC;EACA,WAAOA,MAAP;EACD;;EACDrD,EAAAA,OAAO,CAACC,GAAR,CAAY,0BAAZ;EACA,SAAO,KAAP;EACD;;;EAGD,SAAS0C,QAAT,CAAkBa,GAAlB,EAAuB;EAErBxD,EAAAA,OAAO,CAACC,GAAR,CAAY,iCAAZ;EACAD,EAAAA,OAAO,CAACC,GAAR,CAAYuD,GAAZ;EACA,MAAI/C,QAAQ,GAAG2C,WAAW,CAACI,GAAD,CAA1B;EAEAxD,EAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ;EACA,MAAIwD,IAAI,GAAI,OAAMD,GAAG,CAACnD,GAAI,KACxBmD,GAAG,CAAClD,KAAJ,CAAUO,MAAV,GAAkBqB,QAAQ,CAACsB,GAAG,CAAClD,KAAL,CAA1B,GAAsC,WACvC,GACCG,QAAQ,GAAE,IAAGA,QAAS,EAAd,GAAgB,EACzB,GAJD;EAKAT,EAAAA,OAAO,CAACC,GAAR,CAAY,mCAAmCwD,IAA/C;EAEA,SAAOA,IAAP;EACD;;EAEM,SAASC,iBAAT,CAA2BC,QAA3B,EAAqC;EAC1C3D,EAAAA,OAAO,CAACC,GAAR,CAAY,2DAAZ,EAD0C;;EAI1C,MAAIuD,GAAG,GAAG1D,UAAU,CAAC6D,QAAD,CAApB,CAJ0C;;EAM1C,MAAIF,IAAI,GAAGd,QAAQ,CAACa,GAAD,CAAnB,CAN0C;;EAO1C,MAAII,MAAM,GAAG,IAAIC,QAAJ,CAAc,qBAAoBJ,IAAK,GAAvC,CAAb,CAP0C;EAQ1C;;EAEA,SAAOG,MAAP;EACD;;ECjHM,SAASE,UAAT,CAAoBC,GAApB,EAAwB;EAC7B,SAAO,OAAOA,GAAP,IAAc,UAArB;EACD;EAED;EACA;EACA;EACA;EACA;;EACO,SAASC,QAAT,CAAkBD,GAAlB,EAAuB;EAC5B,SAAO,OAAOA,GAAP,IAAc,QAAd,IAA0BA,GAAG,KAAK,IAAzC;EACD;EAED;EACA;EACA;EACA;EACA;;EACO,SAASE,OAAT,CAAiBF,GAAjB,EAAsB;EAC3B,SAAOG,KAAK,CAACD,OAAN,CAAcF,GAAd,CAAP;EACD;EAED,IAAII,SAAS,GAAG,EAAhB;;EACA,IAAIC,OAAO,GAAG,KAAd;;EACA,SAASC,eAAT,GAA2B;EACzBF,EAAAA,SAAS,CAACG,OAAV,CAAkBC,EAAE,IAAIA,EAAE,EAA1B,EADyB;;EAEzBJ,EAAAA,SAAS,GAAG,EAAZ,CAFyB;;EAGzBC,EAAAA,OAAO,GAAG,KAAV,CAHyB;EAI1B;EAED;EACA;EACA;EACA;EACA;;;EACO,SAASI,QAAT,CAAkBD,EAAlB,EAAsB;EAC3B;EACAJ,EAAAA,SAAS,CAACpD,IAAV,CAAewD,EAAf,EAF2B;;EAG3B,MAAG,CAACH,OAAJ,EAAY;EACVK,IAAAA,OAAO,CAACC,OAAR,GAAkBC,IAAlB,CAAuBN,eAAvB;EACAD,IAAAA,OAAO,GAAG,IAAV,CAFU;EAGX;EACF;EAED,IAAIQ,MAAM,GAAG,EAAb;;EACA,IAAIC,SAAS,GAAG,CACd,cADc,EAEd,SAFc,EAGd,aAHc,EAId,SAJc,CAAhB;EAMAA,SAAS,CAACP,OAAV,CAAkBQ,IAAI,IAAI;EACxB;EACAF,EAAAA,MAAM,CAACE,IAAD,CAAN,GAAe,UAAUC,SAAV,EAAqBC,QAArB,EAA+B;EAC5C,QAAGA,QAAH,EAAY;EAAE;EACZ,UAAGD,SAAH,EAAa;EACX;EACA,eAAOA,SAAS,CAACE,MAAV,CAAiBD,QAAjB,CAAP;EACD,OAHD,MAGK;EACH;EACA;EACA;EACA,YAAGd,KAAK,CAACD,OAAN,CAAce,QAAd,CAAH,EAA2B;EACzB,iBAAOA,QAAP;EACD,SAFD,MAEK;EACH,iBAAO,CAACA,QAAD,CAAP;EACD;EACF;EACF,KAdD,MAcK;EAAG;EACN,aAAOD,SAAP;EACD;EACF,GAlBD;EAmBD,CArBD;;EAwBAH,MAAM,CAACM,UAAP,GAAoB,UAAUH,SAAV,EAAqBC,QAArB,EAA+B;EACjD;EACA,MAAIG,GAAG,GAAGC,MAAM,CAACC,MAAP,CAAcN,SAAd,CAAV;;EACA,MAAGC,QAAH,EAAY;EACV,SAAK,IAAIM,GAAT,IAAgBN,QAAhB,EAA0B;EACzBG,MAAAA,GAAG,CAACG,GAAD,CAAH,GAAWN,QAAQ,CAACM,GAAD,CAAnB;EACA;;EAED,WAAOH,GAAP;EACD;EACF,CAVD;EAWA;EACA;EACA;EACA;EACA;;;EACO,SAASI,YAAT,CAAsBR,SAAtB,EAAiCC,QAAjC,EAA2C;EAChD,MAAIQ,OAAO,GAAG,EAAd;;EACA,OAAI,IAAIF,GAAR,IAAeP,SAAf,EAAyB;EACvBU,IAAAA,UAAU,CAACH,GAAD,CAAV;EACD;;EACD,OAAI,IAAIA,GAAR,IAAeN,QAAf,EAAwB;EACtB;EACA,QAAG,CAACD,SAAS,CAACW,cAAV,CAAyBJ,GAAzB,CAAJ,EAAkC;EAChCG,MAAAA,UAAU,CAACH,GAAD,CAAV;EACD;EACF,GAV+C;;;EAYhD,WAASG,UAAT,CAAoBH,GAApB,EAAyB;EACvB;EACA,QAAIK,KAAK,GAAGf,MAAM,CAACU,GAAD,CAAlB;;EACA,QAAGK,KAAH,EAAS;EACPH,MAAAA,OAAO,CAACF,GAAD,CAAP,GAAeK,KAAK,CAACZ,SAAS,CAACO,GAAD,CAAV,EAAiBN,QAAQ,CAACM,GAAD,CAAzB,CAApB;EACD,KAFD,MAEK;EAAG;EACNE,MAAAA,OAAO,CAACF,GAAD,CAAP,GAAeN,QAAQ,CAACM,GAAD,CAAR,IAAiBP,SAAS,CAACO,GAAD,CAAzC;EACD;EACF;;EAED,SAAOE,OAAP;EACD;;EChHM,SAASI,aAAT,CAAuBC,GAAvB,EAA4B;EACjC;EACA;EACAA,EAAAA,GAAG,CAACL,OAAJ,GAAc,EAAd,CAHiC;;EAIjCK,EAAAA,GAAG,CAACC,KAAJ,GAAY,UAAUN,OAAV,EAAmB;EAC7B,SAAKA,OAAL,GAAeD,YAAY,CAAC,KAAKC,OAAN,EAAeA,OAAf,CAA3B;EACAxF,IAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ,EAAkC,KAAKuF,OAAvC;EACA,WAAO,IAAP,CAH6B;EAI9B,GAJD;EAMA;EACF;EACA;EACA;EACA;;;EACEK,EAAAA,GAAG,CAACE,MAAJ,GAAa,UAAUC,GAAV,EAAe;EAC1B;EACA,UAAMC,KAAK,GAAG,IAAd,CAF0B;;EAI1B,UAAMC,GAAG,GAAG,UAAUV,OAAV,EAAmB;EAC7B;EACA,WAAKW,KAAL,CAAWX,OAAX;EACD,KAHD,CAJ0B;EAU1B;EACA;EACA;EACA;EACA;EACA;EAEA;EACA;EACA;;;EACAU,IAAAA,GAAG,CAACE,SAAJ,GAAgBhB,MAAM,CAACC,MAAP,CAAcY,KAAK,CAACG,SAApB,CAAhB,CApB0B;;EAsB1BF,IAAAA,GAAG,CAACE,SAAJ,CAAcC,WAAd,GAA4BH,GAA5B,CAtB0B;;EAwB1BA,IAAAA,GAAG,CAACV,OAAJ,GAAcD,YAAY,CAACU,KAAK,CAACT,OAAP,EAAgBQ,GAAhB,CAA1B,CAxB0B;;EA0B1BE,IAAAA,GAAG,CAACJ,KAAJ,GAAYD,GAAG,CAACC,KAAhB;EAEA,WAAOI,GAAP;EACD,GA7BD;;EA+BAL,EAAAA,GAAG,CAACL,OAAJ,CAAYN,UAAZ,GAAyB,EAAzB,CA9CiC;;EA+CjC;EACF;EACA;EACA;EACA;;EACEW,EAAAA,GAAG,CAACS,SAAJ,GAAgB,UAAUC,EAAV,EAAcC,UAAd,EAA0B;EAExC;EACA,QAAI5E,IAAI,GAAG4E,UAAU,CAAC5E,IAAX,IAAmB2E,EAA9B;EACAC,IAAAA,UAAU,CAAC5E,IAAX,GAAkBA,IAAlB,CAJwC;;EAOxC,QAAGoC,QAAQ,CAACwC,UAAD,CAAX,EAAwB;EACtBA,MAAAA,UAAU,GAAGX,GAAG,CAACE,MAAJ,CAAWS,UAAX,CAAb;EACD,KATuC;;;EAYxCX,IAAAA,GAAG,CAACL,OAAJ,CAAYN,UAAZ,CAAuBtD,IAAvB,IAA+B4E,UAA/B;EAED,GAdD;EAeD;;ECrED;EACA;EAEA,IAAIC,iBAAiB,GAAGvC,KAAK,CAACkC,SAA9B;EAEA;;EACO,IAAIM,YAAY,GAAGtB,MAAM,CAACC,MAAP,CAAcoB,iBAAd,CAAnB;EAEP;;EACA,IAAIE,OAAO,GAAG,CACZ,MADY,EAEZ,KAFY,EAGZ,OAHY,EAIZ,SAJY,EAKZ,SALY,EAMZ,MANY,EAOZ,QAPY,CAAd;EAWA;EACA;EACA;EACA;EACA;EACA;;EACAA,OAAO,CAACrC,OAAR,CAAgBsC,MAAM,IAAI;EACxB;EACAF,EAAAA,YAAY,CAACE,MAAD,CAAZ,GAAuB,UAAU,GAAGC,IAAb,EAAmB;EACxC7G,IAAAA,OAAO,CAACC,GAAR,CAAY,0BAA0B2G,MAAtC,EADwC;EAGxC;;EACAH,IAAAA,iBAAiB,CAACG,MAAD,CAAjB,CAA0BE,IAA1B,CAA+B,IAA/B,EAAqC,GAAGD,IAAxC,EAJwC;EAOxC;EACA;;EACA,QAAIE,QAAQ,GAAG,IAAf;EACA,QAAIC,EAAE,GAAG,KAAKC,MAAd;;EAEA,YAAQL,MAAR;EACE;EACA,WAAK,QAAL;EAAgB;EACdG,QAAAA,QAAQ,GAAGF,IAAI,CAACtE,KAAL,CAAW,CAAX,CAAX;EAA0B;;EAC5B,WAAK,MAAL,CAJF;;EAKE,WAAK,SAAL;EAAgB;EACdwE,QAAAA,QAAQ,GAAGF,IAAX,CADF;;EAEE;EAPJ,KAZwC;;;EAuBxC,QAAGE,QAAH,EAAYC,EAAE,CAACE,YAAH,CAAgBH,QAAhB,EAvB4B;;EAwBxCC,IAAAA,EAAE,CAACG,GAAH,CAAOC,MAAP,GAxBwC;EAyBzC,GAzBD;EA0BD,CA5BD;;EC1BA,IAAIb,IAAE,GAAG,CAAT;;EAEA,MAAMc,GAAN,CAAU;EACRhB,EAAAA,WAAW,GAAE;EACX,SAAKE,EAAL,GAAUA,IAAE,EAAZ;EACA,SAAKe,IAAL,GAAY,EAAZ;EACD,GAJO;;;EAMRC,EAAAA,MAAM,GAAE;EACN;EACAF,IAAAA,GAAG,CAACG,MAAJ,CAAWC,MAAX,CAAkB,IAAlB;EACD,GATO;;;EAWRC,EAAAA,MAAM,CAACC,OAAD,EAAS;EACb,SAAKL,IAAL,CAAUvG,IAAV,CAAe4G,OAAf;EACD,GAbO;;;EAeRP,EAAAA,MAAM,GAAE;EACN,SAAKE,IAAL,CAAUhD,OAAV,CAAkBqD,OAAO,IAAIA,OAAO,CAACC,MAAR,EAA7B;EACD;;EAjBO;;EAoBVP,GAAG,CAACG,MAAJ,GAAa,IAAb;;EClBO,SAASK,OAAT,CAAiBhG,KAAjB,EAAwB;EAE7B;EACA;EACA,MAAI,CAACmC,QAAQ,CAACnC,KAAD,CAAb,EAAsB;EACpB;EACD,GAN4B;;;EAS7B,MAAGA,KAAK,CAACoF,MAAT,EAAgB;EACd;EACD,GAX4B;;;EAa7B,SAAO,IAAIa,QAAJ,CAAajG,KAAb,CAAP;EACD;;EAED,MAAMiG,QAAN,CAAe;EAEbzB,EAAAA,WAAW,CAACxE,KAAD,EAAQ;EACjB;EACA,SAAKsF,GAAL,GAAW,IAAIE,GAAJ,EAAX,CAFiB;EAGjB;EACA;EACA;EACA;;EACAjC,IAAAA,MAAM,CAAC2C,cAAP,CAAsBlG,KAAtB,EAA6B,QAA7B,EAAuC;EACrCA,MAAAA,KAAK,EAAC,IAD+B;EAErCmG,MAAAA,UAAU,EAAC,KAF0B;;EAAA,KAAvC,EAPiB;;EAYjB,QAAI/D,OAAO,CAACpC,KAAD,CAAX,EAAoB;EAClBA,MAAAA,KAAK,CAACoG,SAAN,GAAkBvB,YAAlB,CADkB;;EAElB1G,MAAAA,OAAO,CAACC,GAAR,CAAY4B,KAAZ;EACA,WAAKqF,YAAL,CAAkBrF,KAAlB,EAHkB;EAInB,KAJD,MAIO;EACL;EACA,WAAKqG,IAAL,CAAUrG,KAAV,EAFK;EAGN;EACF;EAED;EACF;EACA;EACA;EACA;;;EACEqG,EAAAA,IAAI,CAACC,IAAD,EAAO;EACT/C,IAAAA,MAAM,CAACgD,IAAP,CAAYD,IAAZ,EAAkB7D,OAAlB,CAA0BgB,GAAG,IAAI;EAC/B;EACA+C,MAAAA,cAAc,CAACF,IAAD,EAAO7C,GAAP,EAAY6C,IAAI,CAAC7C,GAAD,CAAhB,CAAd;EACD,KAHD;EAID;EAED;EACF;EACA;EACA;EACA;EACA;;;EACE4B,EAAAA,YAAY,CAACiB,IAAD,EAAO;EACjB;EACAA,IAAAA,IAAI,CAAC7D,OAAL,CAAaf,IAAI,IAAIsE,OAAO,CAACtE,IAAD,CAA5B;EACD;;EA7CY;EAgDf;EACA;EACA;EACA;;;EACA,SAAS+E,WAAT,CAAqBzG,KAArB,EAA4B;EAC1B;EACA,OAAI,IAAIO,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGP,KAAK,CAAChB,MAAzB,EAAiCuB,CAAC,EAAlC,EAAqC;EACnC,QAAImG,OAAO,GAAG1G,KAAK,CAACO,CAAD,CAAnB,CADmC;;EAGnCmG,IAAAA,OAAO,CAACtB,MAAR,IAAkBsB,OAAO,CAACtB,MAAR,CAAeE,GAAf,CAAmBI,MAAnB,EAAlB,CAHmC;;EAKnC,QAAGrD,KAAK,CAACD,OAAN,CAAcsE,OAAd,CAAH,EAA0B;EACxBD,MAAAA,WAAW,CAACC,OAAD,CAAX;EACD;EACF;EACF;EACD;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;;EACA,SAASF,cAAT,CAAwBG,GAAxB,EAA6BlD,GAA7B,EAAkCzD,KAAlC,EAAyC;EACvC;EACA,MAAI4G,OAAO,GAAGZ,OAAO,CAAChG,KAAD,CAArB,CAFuC;;EAGvC,MAAIsF,GAAG,GAAG,IAAIE,GAAJ,EAAV,CAHuC;;EAIvCjC,EAAAA,MAAM,CAAC2C,cAAP,CAAsBS,GAAtB,EAA2BlD,GAA3B,EAAgC;EAC9B;EACA;EACAoD,IAAAA,GAAG,GAAG;EACJ,UAAGrB,GAAG,CAACG,MAAP,EAAc;EACZ;EACAL,QAAAA,GAAG,CAACI,MAAJ,GAFY;;EAIZ,YAAGkB,OAAH,EAAW;EAAG;EACZ;EACAA,UAAAA,OAAO,CAACtB,GAAR,CAAYI,MAAZ,GAFS;;EAGT,cAAGrD,KAAK,CAACD,OAAN,CAAcpC,KAAd,CAAH,EAAwB;EAAC;EACvB;EACAyG,YAAAA,WAAW,CAACzG,KAAD,CAAX;EACD;EACF;EACF;;EACD,aAAOA,KAAP;EACD,KAlB6B;;EAmB9B8G,IAAAA,GAAG,CAACC,QAAD,EAAW;EAAE;EACd5I,MAAAA,OAAO,CAACC,GAAR,CAAY,oBAAoBqF,GAApB,GAA0B,eAA1B,GAA4C3E,IAAI,CAACC,SAAL,CAAegI,QAAf,CAAxD;EACA,UAAIA,QAAQ,KAAK/G,KAAjB,EAAwB;EACxBgG,MAAAA,OAAO,CAACe,QAAD,CAAP,CAHY;;EAIZ/G,MAAAA,KAAK,GAAG+G,QAAR;EACAzB,MAAAA,GAAG,CAACC,MAAJ,GALY;EAMb;;EAzB6B,GAAhC;EA2BD;;ECxHM,SAASyB,SAAT,CAAmBC,EAAnB,EAAuB;EAC1B;EACA,QAAMC,IAAI,GAAGD,EAAE,CAACE,QAAhB,CAF0B;;EAK1B,MAAID,IAAI,CAACZ,IAAT,EAAe;EACXc,IAAAA,QAAQ,CAACH,EAAD,CAAR;EACH,GAPyB;EAS1B;EACA;;EAEH;EAED;EACA;EACA;EACA;EACA;EACA;EACA;;EACA,SAASI,KAAT,CAAeJ,EAAf,EAAmBxD,GAAnB,EAAwB6D,MAAxB,EAAgC;EAC5B/D,EAAAA,MAAM,CAAC2C,cAAP,CAAsBe,EAAtB,EAA0BxD,GAA1B,EAA+B;EAC3BoD,IAAAA,GAAG,GAAE;EACD,aAAOI,EAAE,CAACK,MAAD,CAAF,CAAW7D,GAAX,CAAP;EACH,KAH0B;;EAI3BqD,IAAAA,GAAG,CAACC,QAAD,EAAU;EACTE,MAAAA,EAAE,CAACK,MAAD,CAAF,CAAW7D,GAAX,IAAkBsD,QAAlB;EACH;;EAN0B,GAA/B;EAQH;;EAED,SAASK,QAAT,CAAkBH,EAAlB,EAAsB;EAClB9I,EAAAA,OAAO,CAACC,GAAR,CAAY,gCAAZ;EACA,MAAIkI,IAAI,GAAGW,EAAE,CAACE,QAAH,CAAYb,IAAvB,CAFkB;EAIlB;EACA;EACA;;EACAA,EAAAA,IAAI,GAAGW,EAAE,CAACM,KAAH,GAAWtF,UAAU,CAACqE,IAAD,CAAV,GAAmBA,IAAI,CAACrB,IAAL,CAAUgC,EAAV,CAAnB,GAAmCX,IAArD,CAPkB;EAUlB;;EACAN,EAAAA,OAAO,CAACM,IAAD,CAAP,CAXkB;EAalB;;EACA,OAAI,IAAI7C,GAAR,IAAe6C,IAAf,EAAoB;EAChBe,IAAAA,KAAK,CAACJ,EAAD,EAAKxD,GAAL,EAAU,OAAV,CAAL;EACH;EACJ;;EClDD,IAAI+D,KAAK,GAAG,EAAZ;;EACA,IAAIC,GAAG,GAAG,EAAV;;EACA,IAAIC,OAAO,GAAG,KAAd;;EAEA;EACA;EACA;;EACA,SAASC,mBAAT,GAA+B;EAC7B;EACAH,EAAAA,KAAK,CAAC/E,OAAN,CAAcqD,OAAO,IAAIA,OAAO,CAAC8B,GAAR,EAAzB,EAF6B;;EAG7BJ,EAAAA,KAAK,GAAG,EAAR,CAH6B;;EAI7BC,EAAAA,GAAG,GAAG,EAAN,CAJ6B;;EAK7BC,EAAAA,OAAO,GAAG,KAAV,CAL6B;EAM7B;EACD;EAED;EACA;EACA;EACA;;;EACO,SAASG,YAAT,CAAsB/B,OAAtB,EAA+B;EACpC,MAAIpB,EAAE,GAAGoB,OAAO,CAACpB,EAAjB;;EACA,MAAI+C,GAAG,CAAC/C,EAAD,CAAH,IAAW,IAAf,EAAqB;EACnB+C,IAAAA,GAAG,CAAC/C,EAAD,CAAH,GAAU,IAAV;EACA8C,IAAAA,KAAK,CAACtI,IAAN,CAAW4G,OAAX,EAFmB;;EAGnB,QAAI,CAAC4B,OAAL,EAAc;EAAQ;EACpB/E,MAAAA,QAAQ,CAACgF,mBAAD,CAAR;EACAD,MAAAA,OAAO,GAAG,IAAV,CAFY;EAGb;EACF;EACF;;EC9BD,IAAIhD,EAAE,GAAG,CAAT;;EACA,MAAMoD,OAAN,CAAc;EACZtD,EAAAA,WAAW,CAACyC,EAAD,EAAKvE,EAAL,EAASqF,EAAT,EAAapE,OAAb,EAAqB;EAC9B,SAAKsD,EAAL,GAAUA,EAAV;EACA,SAAKvE,EAAL,GAAUA,EAAV;EACA,SAAKqF,EAAL,GAAUA,EAAV;EACA,SAAKpE,OAAL,GAAeA,OAAf;EAEA,SAAKe,EAAL,GAAUA,EAAE,EAAZ,CAN8B;;EAO9B,SAAKsD,MAAL,GAAc,IAAIC,GAAJ,EAAd,CAP8B;;EAQ9B,SAAKC,IAAL,GAAY,EAAZ,CAR8B;;EAS9B,SAAKC,MAAL,GAAczF,EAAd,CAT8B;;EAU9B,SAAKmE,GAAL;EACD;;EACDjB,EAAAA,MAAM,CAACN,GAAD,EAAK;EACT,QAAI8C,GAAG,GAAG9C,GAAG,CAACZ,EAAd,CADS;;EAGT,QAAG,CAAC,KAAKsD,MAAL,CAAYP,GAAZ,CAAgBW,GAAhB,CAAJ,EAAyB;EACvB;EACA,WAAKJ,MAAL,CAAYK,GAAZ,CAAgBD,GAAhB;EACA,WAAKF,IAAL,CAAUhJ,IAAV,CAAeoG,GAAf,EAHuB;;EAKvBA,MAAAA,GAAG,CAACO,MAAJ,CAAW,IAAX;EACD;EACF;;EACDgB,EAAAA,GAAG,GAAE;EACHrB,IAAAA,GAAG,CAACG,MAAJ,GAAa,IAAb,CADG;;EAEH,SAAKwC,MAAL,GAFG;;EAGH3C,IAAAA,GAAG,CAACG,MAAJ,GAAa,IAAb,CAHG;EAIJ;;EACDI,EAAAA,MAAM,GAAE;EACN5H,IAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8B,oBAA9B;EACAyJ,IAAAA,YAAY,CAAC,IAAD,CAAZ;EACD;;EACDD,EAAAA,GAAG,GAAE;EACHzJ,IAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2B,UAA3B;EACA,SAAKyI,GAAL;EACD;;EApCW;;ECHd;EACO,SAASyB,aAAT,CAAuBrB,EAAvB,EAA2BzI,GAA3B,EAAgC8H,IAAI,GAAC,EAArC,EAAyC,GAAG1H,QAA5C,EAAsD;EAC3D;EAEA;EACA,SAAO2J,KAAK,CAACtB,EAAD,EAAKzI,GAAL,EAAU8H,IAAV,EAAgB1H,QAAhB,EAA0B0H,IAAI,CAAC7C,GAA/B,EAAoC+E,SAApC,CAAZ;EACD;EACM,SAASC,UAAT,CAAoBxB,EAApB,EAAwB3H,IAAxB,EAA8B;EACnC;EACA,SAAOiJ,KAAK,CAACtB,EAAD,EAAKuB,SAAL,EAAgBA,SAAhB,EAA2BA,SAA3B,EAAsCA,SAAtC,EAAiDlJ,IAAjD,CAAZ;EACD;EAED;EACA;EACA;EACA;EACA;EACA;EACA;;EACO,SAASoJ,WAAT,CAAqBC,QAArB,EAA+BC,QAA/B,EAAwC;EAC7C,SAAQD,QAAQ,CAACnK,GAAT,KAAiBoK,QAAQ,CAACpK,GAA3B,IAAkCmK,QAAQ,CAAClF,GAAT,KAAiBmF,QAAQ,CAACnF,GAAnE;EACD;EAED;;EACA,SAAS8E,KAAT,CAAetB,EAAf,EAAmBzI,GAAnB,EAAwB8H,IAAxB,EAA8B1H,QAA9B,EAAwC6E,GAAxC,EAA6CnE,IAA7C,EAAmD;EACjD,SAAO;EACL2H,IAAAA,EADK;EACK;EACVzI,IAAAA,GAFK;EAEK;EACV8H,IAAAA,IAHK;EAGK;EACV1H,IAAAA,QAJK;EAIK;EACV6E,IAAAA,GALK;EAKK;EACVnE,IAAAA,IANK;;EAAA,GAAP;EAQD;;EC/BD;EACA;EACA;EACA;EACA;EACA;;EACO,SAASuJ,KAAT,CAAeD,QAAf,EAAyBL,KAAzB,EAAgC;EACrC;EACA;EACA,QAAMO,aAAa,GAAGF,QAAQ,CAACG,QAA/B,CAHqC;;EAIrC,MAAID,aAAJ,EAAmB;EAAC;EAClB;EACA,UAAME,GAAG,GAAGC,SAAS,CAACV,KAAD,CAArB,CAFiB;EAIjB;;EACA,UAAMW,UAAU,GAAGN,QAAQ,CAACM,UAA5B,CALiB;;EAOjB,UAAMC,WAAW,GAAGP,QAAQ,CAACO,WAA7B,CAPiB;EASjB;;EACAD,IAAAA,UAAU,CAACE,YAAX,CAAwBJ,GAAxB,EAA6BG,WAA7B,EAViB;;EAYjBD,IAAAA,UAAU,CAACG,WAAX,CAAuBT,QAAvB;EACA,WAAOI,GAAP;EACD,GAdD,MAcO;EACL7K,IAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8BwK,QAA9B;EACAzK,IAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8BmK,KAA9B,EAFK;;EAIL,QAAI,CAACG,WAAW,CAACE,QAAD,EAAWL,KAAX,CAAhB,EAAmC;EAAC;EAClC,aAAOK,QAAQ,CAAC/H,EAAT,CAAYqI,UAAZ,CAAuBI,YAAvB,CAAoCL,SAAS,CAACV,KAAD,CAA7C,EAAsDK,QAAQ,CAAC/H,EAA/D,CAAP;EACD,KANI;EAUL;;;EACA,QAAIA,EAAE,GAAG0H,KAAK,CAAC1H,EAAN,GAAW+H,QAAQ,CAAC/H,EAA7B,CAXK;;EAYL,QAAI,CAAC+H,QAAQ,CAACpK,GAAd,EAAmB;EAAG;EACpB,UAAIoK,QAAQ,CAACtJ,IAAT,KAAkBiJ,KAAK,CAACjJ,IAA5B,EAAkC;EAAC;EACjC,eAAOuB,EAAE,CAAC0I,WAAH,GAAiBhB,KAAK,CAACjJ,IAA9B;EACD,OAFD,MAEK;EACH;EACA;EACA;EACD;EACF,KApBI;;;EAuBLkK,IAAAA,gBAAgB,CAACjB,KAAD,EAAQK,QAAQ,CAACtC,IAAjB,CAAhB,CAvBK;;EA0BL,QAAImD,WAAW,GAAGb,QAAQ,CAAChK,QAAT,IAAqB,EAAvC;EACA,QAAI8K,WAAW,GAAGnB,KAAK,CAAC3J,QAAN,IAAkB,EAApC,CA3BK;;EA6BL,QAAI6K,WAAW,CAACzK,MAAZ,GAAqB,CAArB,IAA0B0K,WAAW,CAAC1K,MAAZ,IAAsB,CAApD,EAAuD;EACrD6B,MAAAA,EAAE,CAAC8I,SAAH,GAAe,EAAf,CADqD;EAErD;EACD,KAHD,MAGO,IAAIF,WAAW,CAACzK,MAAZ,IAAsB,CAAtB,IAA2B0K,WAAW,CAAC1K,MAAZ,GAAqB,CAApD,EAAuD;EAC5D0K,MAAAA,WAAW,CAACjH,OAAZ,CAAqBmH,KAAD,IAAW;EAAC;EAC9B,YAAIC,QAAQ,GAAGZ,SAAS,CAACW,KAAD,CAAxB,CAD6B;;EAE7B/I,QAAAA,EAAE,CAACiJ,WAAH,CAAeD,QAAf,EAF6B;EAG9B,OAHD,EAD4D;EAM7D,KANM,MAMA;EAAG;EACRE,MAAAA,cAAc,CAAClJ,EAAD,EAAK4I,WAAL,EAAkBC,WAAlB,CAAd;EACD;;EAED,WAAO7I,EAAP,CA1CK;EA2CN;EACF;EAGD;EACA;EACA;EACA;EACA;EACA;EACA;;EACA,SAASkJ,cAAT,CAAwBlJ,EAAxB,EAA4B4I,WAA5B,EAAyCC,WAAzC,EAAsD;EACpD;EACA;EAEA;EACA,MAAIM,aAAa,GAAG,CAApB;EACA,MAAIC,aAAa,GAAGR,WAAW,CAAC,CAAD,CAA/B;EACA,MAAIS,WAAW,GAAGT,WAAW,CAACzK,MAAZ,GAAqB,CAAvC;EACA,MAAImL,WAAW,GAAGV,WAAW,CAACS,WAAD,CAA7B;EAEA,MAAIE,aAAa,GAAG,CAApB;EACA,MAAIC,aAAa,GAAGX,WAAW,CAAC,CAAD,CAA/B;EACA,MAAIY,WAAW,GAAGZ,WAAW,CAAC1K,MAAZ,GAAqB,CAAvC;EACA,MAAIuL,WAAW,GAAGb,WAAW,CAACY,WAAD,CAA7B;EAEA;EACF;EACA;;EACE,WAASE,cAAT,CAAwB5L,QAAxB,EAAkC;EAC/B,QAAI6C,GAAG,GAAG,EAAV;EACA7C,IAAAA,QAAQ,CAAC6D,OAAT,CAAiB,CAACf,IAAD,EAAOzB,KAAP,KAAe;EAC9BwB,MAAAA,GAAG,CAACC,IAAI,CAAC+B,GAAN,CAAH,GAAgBxD,KAAhB;EACD,KAFD;EAGA,WAAOwB,GAAP;EACF;;EAED,MAAIgJ,OAAO,GAAGD,cAAc,CAACf,WAAD,CAA5B,CA1BoD;EA6BpD;EACA;;EACA,SAAOO,aAAa,IAAIE,WAAjB,IAAgCE,aAAa,IAAIE,WAAxD,EAAqE;EACnE;EACA,QAAG,CAACL,aAAJ,EAAkB;EAChBA,MAAAA,aAAa,GAAGR,WAAW,CAAC,EAAEO,aAAH,CAA3B;EACD,KAFD,MAEM,IAAG,CAACG,WAAJ,EAAgB;EACpBA,MAAAA,WAAW,GAAGV,WAAW,CAAC,EAAES,WAAH,CAAzB,CADoB;EAGrB,KAHK,MAGC,IAAIxB,WAAW,CAACuB,aAAD,EAAgBI,aAAhB,CAAf,EAA+C;EACpD;EACA;EACA;EACAxB,MAAAA,KAAK,CAACoB,aAAD,EAAgBI,aAAhB,CAAL,CAJoD;;EAMpDJ,MAAAA,aAAa,GAAGR,WAAW,CAAC,EAAEO,aAAH,CAA3B;EACAK,MAAAA,aAAa,GAAGX,WAAW,CAAC,EAAEU,aAAH,CAA3B,CAPoD;EASrD,KATM,MASD,IAAG1B,WAAW,CAACyB,WAAD,EAAcI,WAAd,CAAd,EAAyC;EAC7C1B,MAAAA,KAAK,CAACsB,WAAD,EAAcI,WAAd,CAAL;EACAJ,MAAAA,WAAW,GAAGV,WAAW,CAAC,EAAES,WAAH,CAAzB;EACAK,MAAAA,WAAW,GAAGb,WAAW,CAAC,EAAEY,WAAH,CAAzB,CAH6C;EAK9C,KALK,MAKA,IAAG5B,WAAW,CAACuB,aAAD,EAAgBM,WAAhB,CAAd,EAA2C;EAC/C;EACA1B,MAAAA,KAAK,CAACoB,aAAD,EAAgBM,WAAhB,CAAL,CAF+C;EAG/C;;EACA1J,MAAAA,EAAE,CAACuI,YAAH,CAAgBa,aAAa,CAACpJ,EAA9B,EAAkCsJ,WAAW,CAACtJ,EAAZ,CAAesI,WAAjD,EAJ+C;;EAM/Cc,MAAAA,aAAa,GAAGR,WAAW,CAAC,EAAEO,aAAH,CAA3B;EACAO,MAAAA,WAAW,GAAGb,WAAW,CAAC,EAAEY,WAAH,CAAzB,CAP+C;EAShD,KATK,MASA,IAAG5B,WAAW,CAACyB,WAAD,EAAcE,aAAd,CAAd,EAA2C;EAC/CxB,MAAAA,KAAK,CAACsB,WAAD,EAAcE,aAAd,CAAL,CAD+C;EAE/C;;EACAxJ,MAAAA,EAAE,CAACuI,YAAH,CAAgBe,WAAW,CAACtJ,EAA5B,EAAgCoJ,aAAa,CAACpJ,EAA9C,EAH+C;EAI/C;;EACAsJ,MAAAA,WAAW,GAAGV,WAAW,CAAC,EAAES,WAAH,CAAzB;EACAG,MAAAA,aAAa,GAAGX,WAAW,CAAC,EAAEU,aAAH,CAA3B;EACD,KAPK,MAOD;EACH;EACA;EACA,UAAIM,SAAS,GAAGD,OAAO,CAACJ,aAAa,CAAC5G,GAAf,CAAvB;;EACA,UAAGiH,SAAS,IAAIlC,SAAhB,EAA0B;EAAC;EACzB;EACA3H,QAAAA,EAAE,CAACuI,YAAH,CAAgBH,SAAS,CAACoB,aAAD,CAAzB,EAA0CJ,aAAa,CAACpJ,EAAxD;EACD,OAHD,MAGK;EAAG;EACN;EACA,YAAI8J,SAAS,GAAGlB,WAAW,CAACiB,SAAD,CAA3B,CAFG;EAGH;;EACA7B,QAAAA,KAAK,CAAC8B,SAAD,EAAYN,aAAZ,CAAL;EACAxJ,QAAAA,EAAE,CAACuI,YAAH,CAAgBuB,SAAS,CAAC9J,EAA1B,EAA8BoJ,aAAa,CAACpJ,EAA5C,EALG;;EAOH4I,QAAAA,WAAW,CAACiB,SAAD,CAAX,GAAyBlC,SAAzB;EACD,OAfE;EAiBH;EACA;EACA;;;EACA6B,MAAAA,aAAa,GAAGX,WAAW,CAAC,EAAEU,aAAH,CAA3B;EACD;EACF,GA1FmD;EA8FpD;;;EACA,MAAIA,aAAa,IAAIE,WAArB,EAAkC;EAChC;EACA,SAAK,IAAI/J,CAAC,GAAG6J,aAAb,EAA4B7J,CAAC,IAAI+J,WAAjC,EAA8C/J,CAAC,EAA/C,EAAmD;EACjD;EACA;EACA;EACA;EACA;EACA;EACA,UAAIqK,MAAM,GAAGlB,WAAW,CAACY,WAAW,GAAG,CAAf,CAAX,IAAgC,IAAhC,GAAuC,IAAvC,GAA8CZ,WAAW,CAACY,WAAW,GAAG,CAAf,CAAX,CAA6BzJ,EAAxF,CAPiD;EASjD;EACA;EACA;EACA;;EACAA,MAAAA,EAAE,CAACuI,YAAH,CAAgBH,SAAS,CAACS,WAAW,CAACnJ,CAAD,CAAZ,CAAzB,EAA0CqK,MAA1C;EACD;EACF,GAhHmD;;;EAkHpD,MAAGZ,aAAa,IAAIE,WAApB,EAAgC;EAC9B,SAAI,IAAI3J,CAAC,GAAGyJ,aAAZ,EAA2BzJ,CAAC,IAAI2J,WAAhC,EAA6C3J,CAAC,EAA9C,EAAiD;EAC/C,UAAIqJ,KAAK,GAAGH,WAAW,CAAClJ,CAAD,CAAvB,CAD+C;;EAG/CqJ,MAAAA,KAAK,IAAI/I,EAAE,CAACwI,WAAH,CAAeO,KAAK,CAAC/I,EAArB,CAAT;EACD;EACF;EACF;;;EAGM,SAASoI,SAAT,CAAmBV,KAAnB,EAA0B;EAC/B;EACA,MAAI;EAAE/J,IAAAA,GAAF;EAAO8H,IAAAA,IAAP;EAAa1H,IAAAA,QAAb;EAAuBU,IAAAA,IAAvB;EAA6B2H,IAAAA;EAA7B,MAAoCsB,KAAxC,CAF+B;;EAK/B,MAAI,OAAO/J,GAAP,KAAe,QAAnB,EAA6B;EAAE;EAC7B;EACA+J,IAAAA,KAAK,CAAC1H,EAAN,GAAWgK,QAAQ,CAACvC,aAAT,CAAuB9J,GAAvB,CAAX,CAF2B;;EAG3BgL,IAAAA,gBAAgB,CAACjB,KAAD,EAAQjC,IAAR,CAAhB,CAH2B;EAI3B;;EACA1H,IAAAA,QAAQ,CAAC6D,OAAT,CAAiBmH,KAAK,IAAI;EAAE;EAC1BrB,MAAAA,KAAK,CAAC1H,EAAN,CAASiJ,WAAT,CAAqBb,SAAS,CAACW,KAAD,CAA9B;EACD,KAFD;EAGD,GARD,MAQO;EAAE;EACPrB,IAAAA,KAAK,CAAC1H,EAAN,GAAWgK,QAAQ,CAACC,cAAT,CAAwBxL,IAAxB,CAAX,CADK;EAEN;;EACD,SAAOiJ,KAAK,CAAC1H,EAAb;EACD;EAGD;;EACA,SAAS2I,gBAAT,CAA0BjB,KAA1B,EAAiCwC,QAAQ,GAAG,EAA5C,EAAgD;EAC9C;EACA;EACA,MAAIlK,EAAE,GAAG0H,KAAK,CAAC1H,EAAf,CAH8C;;EAI9C,MAAImK,QAAQ,GAAGzC,KAAK,CAACjC,IAAN,IAAc,EAA7B,CAJ8C;;EAM9C,MAAI2E,QAAQ,GAAGD,QAAQ,CAACE,KAAT,IAAkB,EAAjC;EACA,MAAIC,QAAQ,GAAGJ,QAAQ,CAACG,KAAT,IAAkB,EAAjC,CAP8C;;EAU9C,OAAK,IAAIzH,GAAT,IAAgB0H,QAAhB,EAA0B;EAAE;EAC1B,QAAI,CAACF,QAAQ,CAACxH,GAAD,CAAb,EAAoB;EAClB5C,MAAAA,EAAE,CAACqK,KAAH,CAASzH,GAAT,IAAgB,EAAhB;EACD;EACF,GAd6C;;;EAiB9C,OAAK,IAAIA,GAAT,IAAgBuH,QAAhB,EAA0B;EAAE;EAC1B;EACA;EACA,QAAIvH,GAAG,IAAI,OAAX,EAAoB;EAAE;EACpB,WAAK,IAAIA,GAAT,IAAgBwH,QAAhB,EAA0B;EAAE;EAC1B9M,QAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuByC,EAAE,CAACqK,KAAH,CAASzH,GAAT,CAAvB,EAAsCwH,QAAQ,CAACxH,GAAD,CAA9C;EACA5C,QAAAA,EAAE,CAACqK,KAAH,CAASzH,GAAT,IAAgBwH,QAAQ,CAACxH,GAAD,CAAxB;EACD;EACF,KALD,MAKO;EACL5C,MAAAA,EAAE,CAACuK,YAAH,CAAgB3H,GAAhB,EAAqBuH,QAAQ,CAACvH,GAAD,CAA7B;EACD;EACF,GA5B6C;;;EA8B9C,OAAK,IAAIA,GAAT,IAAgBsH,QAAhB,EAA0B;EACxB,QAAI,CAACC,QAAQ,CAACvH,GAAD,CAAb,EAAoB;EAClB5C,MAAAA,EAAE,CAACwK,eAAH,CAAmB5H,GAAnB;EACD;EACF;EACF;;ECjQM,SAAS6H,cAAT,CAAwBrE,EAAxB,EAA4B;EACjC;EACA;EACA;EACA;EACA;EACA,MAAIsE,eAAe,GAAG,MAAI;EACxBtE,IAAAA,EAAE,CAACuE,OAAH,CAAWvE,EAAE,CAACwE,OAAH,EAAX;EACD,GAFD,CANiC;;;EAWjCC,EAAAA,QAAQ,CAACzE,EAAD,EAAK,cAAL,CAAR,CAXiC;;EAcjC,MAAIa,OAAJ,CAAYb,EAAZ,EAAgBsE,eAAhB,EAAiC,MAAI;EACnCpN,IAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EADmC;;EAGnCsN,IAAAA,QAAQ,CAACzE,EAAD,EAAK,SAAL,CAAR;EACD,GAJD,EAIE,IAJF,EAdiC;;EAqBhCyE,EAAAA,QAAQ,CAACzE,EAAD,EAAK,SAAL,CAAR;EACF;EAEM,SAAS0E,cAAT,CAAwB3H,GAAxB,EAA4B;EACjCA,EAAAA,GAAG,CAACO,SAAJ,CAAciH,OAAd,GAAwB,UAAUjD,KAAV,EAAiB;EACvCpK,IAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ,EAA4BmK,KAA5B;EACA,UAAMtB,EAAE,GAAG,IAAX,CAFuC;;EAIvC,QAAI2E,QAAQ,GAAG3E,EAAE,CAAC2E,QAAlB,CAJuC;;EAMvC3E,IAAAA,EAAE,CAAC2E,QAAH,GAAcrD,KAAd,CANuC;;EAQvC,QAAG,CAACqD,QAAJ,EAAa;EAAC;EACZ;EACA3E,MAAAA,EAAE,CAAC4E,GAAH,GAAShD,KAAK,CAAC5B,EAAE,CAAC4E,GAAJ,EAAStD,KAAT,CAAd;EACD,KAHD,MAGK;EAAC;EACJtB,MAAAA,EAAE,CAAC4E,GAAH,GAAShD,KAAK,CAAC+C,QAAD,EAAWrD,KAAX,CAAd;EACD;EACF,GAdD;EAeD;EAED;EACA;EACA;EACA;EACA;EACA;;EACO,SAASmD,QAAT,CAAkBzE,EAAlB,EAAsBhE,IAAtB,EAA2B;EAChC;EACA,MAAI6I,QAAQ,GAAG7E,EAAE,CAACE,QAAH,CAAYlE,IAAZ,CAAf;;EACA,MAAG6I,QAAH,EAAY;EACVA,IAAAA,QAAQ,CAACrJ,OAAT,CAAiBC,EAAE,IAAI;EACrBA,MAAAA,EAAE,CAACuC,IAAH,CAAQgC,EAAR,EADqB;EAEtB,KAFD;EAGD;EACF;;ECtDM,SAAS8E,SAAT,CAAmB/H,GAAnB,EAAwB;EAC7B;EACAA,EAAAA,GAAG,CAACO,SAAJ,CAAcD,KAAd,GAAsB,UAAUX,OAAV,EAAmB;EACvC,UAAMsD,EAAE,GAAG,IAAX,CADuC;EAEvC;EACA;;EACA;EACAA,IAAAA,EAAE,CAACE,QAAH,GAAczD,YAAY,CAACuD,EAAE,CAACzC,WAAH,CAAeb,OAAhB,EAAyBA,OAAzB,CAA1B,CALuC;;EAOvCqD,IAAAA,SAAS,CAACC,EAAD,CAAT,CAPuC;;EAQvC,QAAIA,EAAE,CAACE,QAAH,CAAYtG,EAAhB,EAAoB;EAClB;EACAoG,MAAAA,EAAE,CAAC+E,MAAH,CAAU/E,EAAE,CAACE,QAAH,CAAYtG,EAAtB;EACD;EACF,GAZD,CAF6B;;;EAiB7BmD,EAAAA,GAAG,CAACO,SAAJ,CAAcyH,MAAd,GAAuB,UAAUnL,EAAV,EAAc;EACnC1C,IAAAA,OAAO,CAACC,GAAR,CAAY,0BAA0ByC,EAA1B,GAA+B,OAA3C;EACA,UAAMoG,EAAE,GAAG,IAAX;EACA,UAAMC,IAAI,GAAGD,EAAE,CAACE,QAAhB;EACAtG,IAAAA,EAAE,GAAGgK,QAAQ,CAACoB,aAAT,CAAuBpL,EAAvB,CAAL,CAJmC;;EAKnCoG,IAAAA,EAAE,CAAC4E,GAAH,GAAShL,EAAT,CALmC;;EAMnC1C,IAAAA,OAAO,CAACC,GAAR,CAAY,kBAAkByC,EAA9B,EANmC;;EASnC,QAAI,CAACqG,IAAI,CAACnF,MAAV,EAAkB;EAChB5D,MAAAA,OAAO,CAACC,GAAR,CAAY,mCAAZ,EADgB;;EAGhB,UAAI0D,QAAQ,GAAGoF,IAAI,CAACpF,QAApB;;EACA,UAAI,CAACA,QAAL,EAAe;EACb3D,QAAAA,OAAO,CAACC,GAAR,CAAY,4CAA4CyC,EAAE,CAACqL,SAA3D,EADa;;EAGbpK,QAAAA,QAAQ,GAAGjB,EAAE,CAACqL,SAAd;EACD,OAJD,MAIK;EACH/N,QAAAA,OAAO,CAACC,GAAR,CAAY,2BAA2B0D,QAAvC;EACD;;EAED,UAAIC,MAAM,GAAGF,iBAAiB,CAACC,QAAD,CAA9B;EACAoF,MAAAA,IAAI,CAACnF,MAAL,GAAcA,MAAd;EACA5D,MAAAA,OAAO,CAACC,GAAR,CAAY,uCAAuC2D,MAAM,CAACoK,QAAP,EAAnD;EACD,KAxBkC;;;EA2BnCb,IAAAA,cAAc,CAACrE,EAAD,CAAd;EACD,GA5BD;;EA8BAjD,EAAAA,GAAG,CAACO,SAAJ,CAAc6H,SAAd,GAA0BzJ,QAA1B;EACD;;EClDM,SAAS0J,WAAT,CAAqBrI,GAArB,EAA0B;EAC/BA,EAAAA,GAAG,CAACO,SAAJ,CAAc+H,EAAd,GAAmB,YAAY;EAAG;EAChC,UAAMrF,EAAE,GAAG,IAAX;EACA,WAAOqB,aAAa,CAACrB,EAAD,EAAK,GAAGxG,SAAR,CAApB,CAF6B;EAG9B,GAHD;;EAIAuD,EAAAA,GAAG,CAACO,SAAJ,CAAcgI,EAAd,GAAmB,UAAUjN,IAAV,EAAgB;EAAG;EACpC,UAAM2H,EAAE,GAAG,IAAX;EACA,WAAOwB,UAAU,CAACxB,EAAD,EAAK3H,IAAL,CAAjB;EACD,GAHD;;EAIA0E,EAAAA,GAAG,CAACO,SAAJ,CAAciI,EAAd,GAAmB,UAAUtK,GAAV,EAAe;EAAG;EACnC,QAAGC,QAAQ,CAACD,GAAD,CAAX,EAAiB;EAAG;EAClB,aAAOpD,IAAI,CAACC,SAAL,CAAemD,GAAf,CAAP;EACD,KAFD,MAEO;EAAG;EACR,aAAOA,GAAP;EACD;EACF,GAND;;EAOA8B,EAAAA,GAAG,CAACO,SAAJ,CAAckH,OAAd,GAAwB,YAAY;EAClC,UAAMxE,EAAE,GAAG,IAAX,CADkC;;EAElC,QAAI;EAAElF,MAAAA;EAAF,QAAakF,EAAE,CAACE,QAApB;EACA,QAAIoB,KAAK,GAAGxG,MAAM,CAACkD,IAAP,CAAYgC,EAAZ,CAAZ,CAHkC;;EAIlC,WAAOsB,KAAP;EACD,GALD;EAMD;;EClBD;EACA;EACA;EACA;;EACA,SAASvE,GAAT,CAAaL,OAAb,EAAsB;EAClB,OAAKW,KAAL,CAAWX,OAAX,EADkB;;EAErB;;EAEDoI,SAAS,CAAC/H,GAAD,CAAT;EACAqI,WAAW,CAACrI,GAAD,CAAX;;EACA2H,cAAc,CAAC3H,GAAD,CAAd;EACAD,aAAa,CAACC,GAAD,CAAb;;;;;;;;"}